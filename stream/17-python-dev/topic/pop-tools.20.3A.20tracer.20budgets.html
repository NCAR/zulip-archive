<html>
<head><meta charset="utf-8"><title>pop-tools : tracer budgets · python-dev · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://127.0.0.1:4000/html/stream/17-python-dev/index.html">python-dev</a></h2>
<h3>Topic: <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html">pop-tools : tracer budgets</a></h3>

<hr>

<base href="https://zulip2.cloud.ucar.edu">

<head><link href="http://127.0.0.1:4000/style.css" rel="stylesheet"></head>

<a name="16801"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/16801" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen Yeager <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#16801">(Sep 03 2020 at 21:59)</a>:</h4>
<p>Is there any status update on this development (issue #7)?</p>



<a name="16819"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/16819" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#16819">(Sep 04 2020 at 15:00)</a>:</h4>
<p><span class="user-mention" data-user-id="84">@Yassir Eddebbar</span>, <span class="user-mention" data-user-id="40">@Riley Brady</span>, <span class="user-mention" data-user-id="31">@Keith Lindsay</span> and <span class="user-mention" data-user-id="25">@Deepak Cherian</span> have been following this issue. I think we've foundered a bit, but would be good to assess and revive.</p>



<a name="16826"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/16826" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deepak Cherian <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#16826">(Sep 04 2020 at 15:13)</a>:</h4>
<p>a bunch of the pieces are almost there <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>
<ol>
<li>we know how to set up xgcm: <a href="https://pop-tools.readthedocs.io/en/latest/examples/pop_div_curl_xr_xgcm_metrics_compare.html" target="_blank" title="https://pop-tools.readthedocs.io/en/latest/examples/pop_div_curl_xr_xgcm_metrics_compare.html">https://pop-tools.readthedocs.io/en/latest/examples/pop_div_curl_xr_xgcm_metrics_compare.html</a></li>
<li>we know how to specify metrics: <a href="https://github.com/NCAR/pop-tools/issues/40" target="_blank" title="https://github.com/NCAR/pop-tools/issues/40">https://github.com/NCAR/pop-tools/issues/40</a></li>
<li>we have unfinished code to estimate metrics that havenot been saved to disk: <a href="https://github.com/NCAR/pop-tools/pull/44" target="_blank" title="https://github.com/NCAR/pop-tools/pull/44">https://github.com/NCAR/pop-tools/pull/44</a>, <a href="https://github.com/NCAR/pop-tools/pull/54" target="_blank" title="https://github.com/NCAR/pop-tools/pull/54">https://github.com/NCAR/pop-tools/pull/54</a></li>
<li>and there is unifinished code for div, grad, curl: <a href="https://github.com/xgcm/xgcm/issues/187" target="_blank" title="https://github.com/xgcm/xgcm/issues/187">https://github.com/xgcm/xgcm/issues/187</a></li>
</ol>
<p>cc <span class="user-mention" data-user-id="27">@Anna-Lena Deppenmeier</span></p>



<a name="16827"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/16827" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#16827">(Sep 04 2020 at 15:16)</a>:</h4>
<p>Hi all, <span class="user-mention" data-user-id="84">@Yassir Eddebbar</span>  and I have been working on a notebook that closes, for example, temperature budget with xarray only, with xgcm and with xgcm metrics. I would say what works now is closing the temperature budget with xgcm, it's not optimally using metrics yet and xarray only has some problems.</p>



<a name="16828"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/16828" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#16828">(Sep 04 2020 at 15:17)</a>:</h4>
<p>I could turn the xgcm version into a function and move it to pop-tools.</p>



<a name="16829"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/16829" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#16829">(Sep 04 2020 at 15:17)</a>:</h4>
<p>it does need DZU which as far as I understand cannot be calculated from the released version of pop-tools right now?!</p>



<a name="16830"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/16830" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deepak Cherian <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#16830">(Sep 04 2020 at 15:18)</a>:</h4>
<p>wow much further along than I thought ! nice!</p>



<a name="16831"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/16831" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#16831">(Sep 04 2020 at 15:21)</a>:</h4>
<p>yeah it's POP specific, though. Which is fine for pop-tools, I guess</p>



<a name="16835"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/16835" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riley Brady <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#16835">(Sep 04 2020 at 16:20)</a>:</h4>
<p>Hi all; glad this is making some headway.</p>
<p>I was looking to flesh out some convenience variables from the <code>get_grid()</code> function so we could really easily wrangle this with <code>xgcm</code> (DZU, DZT, HU, HT, KMU). I could use some feedback on <a href="https://github.com/NCAR/pop-tools/pull/54" target="_blank" title="https://github.com/NCAR/pop-tools/pull/54">https://github.com/NCAR/pop-tools/pull/54</a> and we need to get <a href="https://github.com/NCAR/pop-tools/pull/44" target="_blank" title="https://github.com/NCAR/pop-tools/pull/44">https://github.com/NCAR/pop-tools/pull/44</a> merged. We might not need every one of those variables, but if I remember correctly <code>DZU</code> and <code>DZT</code> are needed.</p>
<p>Also some thoughts on <a href="https://github.com/NCAR/pop-tools/issues/56" target="_blank" title="https://github.com/NCAR/pop-tools/issues/56">https://github.com/NCAR/pop-tools/issues/56</a> would be useful -- getting <code>DZBC</code> could help us close budgets for runs with partial bottom cells. Although maybe that is a step we take in a future PR. We also haven't done anything to deal with the overflow parameterization that <span class="user-mention" data-user-id="14">@Matt Long</span> meticulously deals with in his NCL code, but again this should be dealt with after the first iteration of this code.</p>
<p>There's a lot of discussion on my original purely <code>xarray</code> implementation here that might help in making the updated version work well: <a href="https://github.com/NCAR/pop-tools/pull/12" target="_blank" title="https://github.com/NCAR/pop-tools/pull/12">https://github.com/NCAR/pop-tools/pull/12</a>. I closed it in favor of giving code/feedback to <span class="user-mention" data-user-id="84">@Yassir Eddebbar</span> and <span class="user-mention" data-user-id="27">@Anna-Lena Deppenmeier</span> on doing a purely <code>xgcm</code> implementation.</p>



<a name="16836"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/16836" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riley Brady <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#16836">(Sep 04 2020 at 16:22)</a>:</h4>
<p>Here's a demo from <span class="user-mention" data-user-id="84">@Yassir Eddebbar</span>  and <span class="user-mention" data-user-id="27">@Anna-Lena Deppenmeier</span> closing the O2 budget using purely <code>xgcm</code>: <a href="https://nbviewer.jupyter.org/gist/Eddebbar/cb30e0e4a3151b2900fb49648e1e50c8" target="_blank" title="https://nbviewer.jupyter.org/gist/Eddebbar/cb30e0e4a3151b2900fb49648e1e50c8">https://nbviewer.jupyter.org/gist/Eddebbar/cb30e0e4a3151b2900fb49648e1e50c8</a>. Yassir and I had talked about just hosting these as examples on the <code>pop-tools</code> docs so folks could just follow along themselves. I still think it'd be valuable to have a function in the package. The best advice I can give from our discussion on my PR is to use YAML files to denote the variables specifically needed for each tracer. For instance, iron needs <code>IRON_FLUX</code>, while O2 needs <code>STF_O2</code>, while DIC needs <code>FG_CO2</code>. We can have an exhaustive list for the tracer variables on what is needed.</p>



<a name="16843"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/16843" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassir Eddebbar <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#16843">(Sep 04 2020 at 17:02)</a>:</h4>
<p>Another minor issue is that budget terms are not all available as outputs in many runs, e.g. for BGC in the high res runs,  which prevents demonstrating full budget closure for now. e.g. the gist posted above by <span class="user-mention" data-user-id="40">@Riley Brady</span> is missing the <code>HDIF</code> terms, which likely explains the lack of budget closure.  </p>
<p><span class="user-mention" data-user-id="27">@Anna-Lena Deppenmeier</span> , a pop_tools function would be awesome, happy to help with BGC implementation. A couple other differences for BGC vs heat budgets are lack of a <code>QSW_3D</code> term for BGC budgets, and handling different units for various BGC terms (with ```YAML files too?), both manageable I think.</p>



<a name="16844"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/16844" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riley Brady <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#16844">(Sep 04 2020 at 17:11)</a>:</h4>
<p><span class="user-mention" data-user-id="84">@Yassir Eddebbar</span>, <span class="user-mention" data-user-id="34">@Stephen Yeager</span>'s FOSI run under the CESM-DPLE directory has a lot of the terms. That's what I based my original closure demos and code on in the previous PR. See <code>/glade/p/cesm/community/CESM-DPLE/CESM-DPLE_POPCICEhindcast</code></p>



<a name="16845"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/16845" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riley Brady <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#16845">(Sep 04 2020 at 17:12)</a>:</h4>
<p>Here's a demo YAML file: <a href="https://github.com/NCAR/pop-tools/blob/master/pop_tools/pop_grid_definitions.yaml" target="_blank" title="https://github.com/NCAR/pop-tools/blob/master/pop_tools/pop_grid_definitions.yaml">https://github.com/NCAR/pop-tools/blob/master/pop_tools/pop_grid_definitions.yaml</a>. I would envision the headers being the given variable name, then the sub-sections could be a list of required/expected budget variables (could make some optional based on run output) and other booleans as needed.</p>
<p>I still think if we can advance discussion on <code>get_grid()</code> returning some of the other grid diagnostics/metrics we should be able to implement this pretty smoothly.</p>



<a name="16846"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/16846" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassir Eddebbar <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#16846">(Sep 04 2020 at 17:17)</a>:</h4>
<blockquote>
<p><span class="user-mention silent" data-user-id="84">Yassir Eddebbar</span>, <span class="user-mention silent" data-user-id="34">Stephen Yeager</span>'s FOSI run under the CESM-DPLE directory has a lot of the terms. That's what I based my original closure demos and code on in the previous PR. See <code>/glade/p/cesm/community/CESM-DPLE/CESM-DPLE_POPCICEhindcast</code></p>
</blockquote>
<p>Excellent. I'll test on those!</p>



<a name="26002"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26002" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen Yeager <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26002">(Mar 01 2021 at 20:11)</a>:</h4>
<p><span class="user-mention" data-user-id="27">@Anna-Lena Deppenmeier</span> <span class="user-mention" data-user-id="84">@Yassir Eddebbar</span>  Would you be willing to share your notebook that closes the POP temperature budget using xarray and xgcm?</p>



<a name="26003"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26003" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26003">(Mar 01 2021 at 20:24)</a>:</h4>
<p>sure, I am just running it now to make sure it works properly and will share it then</p>



<a name="26004"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26004" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26004">(Mar 01 2021 at 20:27)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="134">@Max Grover</span></p>



<a name="26015"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26015" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassir Eddebbar <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26015">(Mar 01 2021 at 22:45)</a>:</h4>
<p>Not sure if of interest, but I have an [O2] budget version with major input from <span class="user-mention" data-user-id="27">@Anna-Lena Deppenmeier</span> as well, need to rerun and clean too...</p>



<a name="26033"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26033" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26033">(Mar 02 2021 at 00:11)</a>:</h4>
<p>Currently my budget is not closing. Not sure why, this is the same code that closed a while ago, before a bunch of updates. Am looking into it and hopefully can close it again soon.</p>



<a name="26129"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26129" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26129">(Mar 02 2021 at 23:33)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="34">@Stephen Yeager</span>   I have something that works, do you currently work on the CGD system or casper/cheyenne?</p>



<a name="26131"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26131" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen Yeager <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26131">(Mar 03 2021 at 00:47)</a>:</h4>
<p>Great!  Prefer something that works on casper. Thank you very much for debugging and sharing!</p>



<a name="26132"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26132" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26132">(Mar 03 2021 at 16:01)</a>:</h4>
<p>ok, I'm currently running it on cgd. I will put it on casper and make sure it works, then I'll let you know where to find it.</p>



<a name="26133"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26133" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deepak Cherian <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26133">(Mar 03 2021 at 16:07)</a>:</h4>
<p>Anna you should upload it to pop-tools!</p>



<a name="26134"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26134" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26134">(Mar 03 2021 at 16:09)</a>:</h4>
<p>The notebook itself? Or change it into a function?</p>



<a name="26135"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26135" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deepak Cherian <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26135">(Mar 03 2021 at 16:11)</a>:</h4>
<p>The notebook. almost 0 effort <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>



<a name="26172"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26172" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26172">(Mar 03 2021 at 19:37)</a>:</h4>
<p>ok so here come the problems. so far it's not running on casper -- I assume something to do with xgcm. This is the error I get when I try to convert my dataset ds into a xgcm compatible dataset:</p>
<div class="codehilite"><pre><span></span><span class="c1"># here we get the xgcm compatible dataset</span>
<span class="n">gridx</span><span class="p">,</span> <span class="n">dsx</span> <span class="o">=</span> <span class="n">pop_tools</span><span class="o">.</span><span class="n">to_xgcm_grid_dataset</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">6</span><span class="o">-</span><span class="n">c629003e2721</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
      <span class="mi">1</span> <span class="c1"># here we get the xgcm compatible dataset</span>
<span class="o">----&gt;</span> <span class="mi">2</span> <span class="n">gridx</span><span class="p">,</span> <span class="n">dsx</span> <span class="o">=</span> <span class="n">pop_tools</span><span class="o">.</span><span class="n">to_xgcm_grid_dataset</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
      <span class="mi">3</span>
      <span class="mi">4</span> <span class="c1"># make sure we have the cell volumne for calculations</span>
      <span class="mi">5</span> <span class="n">dsx</span><span class="p">[</span><span class="s2">&quot;cell_volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dsx</span><span class="o">.</span><span class="n">DZT</span> <span class="o">*</span> <span class="n">dsx</span><span class="o">.</span><span class="n">DXT</span> <span class="o">*</span> <span class="n">dsx</span><span class="o">.</span><span class="n">DYT</span>

<span class="o">/</span><span class="n">glade</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">deppenme</span><span class="o">/</span><span class="n">miniconda3</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">analysis</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pop_tools</span><span class="o">/</span><span class="n">xgcm_util</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="n">to_xgcm_grid_dataset</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="mi">202</span>
    <span class="mi">203</span>     <span class="k">try</span><span class="p">:</span>
<span class="o">--&gt;</span> <span class="mi">204</span>         <span class="kn">import</span> <span class="nn">xgcm</span>
    <span class="mi">205</span>     <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="mi">206</span>         <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>

<span class="o">/</span><span class="n">glade</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">deppenme</span><span class="o">/</span><span class="n">miniconda3</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">analysis</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">xgcm</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
      <span class="mi">4</span> <span class="k">del</span> <span class="n">get_versions</span>
      <span class="mi">5</span>
<span class="o">----&gt;</span> <span class="mi">6</span> <span class="kn">from</span> <span class="nn">.grid</span> <span class="kn">import</span> <span class="n">Grid</span><span class="p">,</span> <span class="n">Axis</span>
      <span class="mi">7</span> <span class="kn">from</span> <span class="nn">.autogenerate</span> <span class="kn">import</span> <span class="n">generate_grid_ds</span>

<span class="o">/</span><span class="n">glade</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">deppenme</span><span class="o">/</span><span class="n">miniconda3</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">analysis</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">xgcm</span><span class="o">/</span><span class="n">grid</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="mi">757</span>
    <span class="mi">758</span>
<span class="o">--&gt;</span> <span class="mi">759</span> <span class="k">class</span> <span class="nc">Grid</span><span class="p">:</span>
    <span class="mi">760</span>     <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    761     An object with multiple :class:`xgcm.Axis` objects representing different</span>

<span class="s2">/glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages/xgcm/grid.py in Grid()</span>
<span class="s2">   1065         return out</span>
<span class="s2">   1066</span>
<span class="s2">-&gt; 1067     @docstrings.dedent</span>
<span class="s2">   1068     def _apply_vector_function(self, function, vector, **kwargs):</span>
<span class="s2">   1069         # the keys, should be axis names</span>

<span class="s2">/glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages/docrep/decorators.py in update_docstring(self, *args, **kwargs)</span>
<span class="s2">     41             return func(self, *args, **kwargs)</span>
<span class="s2">     42         elif len(args) and callable(args[0]):</span>
<span class="s2">---&gt; 43             doc = func(self, args[0].__doc__, *args[1:], **kwargs)</span>
<span class="s2">     44             _set_object_doc(args[0], doc, py2_class=self.python2_classes)</span>
<span class="s2">     45             return args[0]</span>

<span class="s2">/glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages/docrep/__init__.py in dedent(self, s, stacklevel)</span>
<span class="s2">    532             encountering an invalid key in the string</span>
<span class="s2">    533         &quot;&quot;&quot;</span>
<span class="o">--&gt;</span> <span class="mi">534</span>         <span class="n">s</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="mi">535</span>         <span class="k">return</span> <span class="n">safe_modulo</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">)</span>
    <span class="mi">536</span>

<span class="o">/</span><span class="n">glade</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">deppenme</span><span class="o">/</span><span class="n">miniconda3</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">analysis</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">inspect</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="n">cleandoc</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="mi">617</span>     <span class="n">onwards</span> <span class="ow">is</span> <span class="n">removed</span><span class="o">.</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    618     try:</span>
<span class="s2">--&gt; 619         lines = doc.expandtabs().split(&#39;</span><span class="se">\n</span><span class="s2">&#39;)</span>
<span class="s2">    620     except UnicodeError:</span>
<span class="s2">    621         return None</span>

<span class="s2">AttributeError: &#39;NoneType&#39; object has no attribute &#39;expandtabs&#39;</span>
</pre></div>


<p>I have tried updating my environment and making sure the relevant packages are the same version, but I fail wrt <code>pop-tools</code> and <code>xgcm</code>.</p>
<div class="codehilite"><pre><span></span>conda_analysis_casper.txt:pop-tools                 <span class="m">2020</span>.2.17.post6          pypi_0    pypi
conda_dcpy_andre.txt:pop-tools                 <span class="m">2020</span>.12.15         pyhd8ed1ab_0    conda-forge
</pre></div>


<p>When I run <code>conda update -c conda-forge pop-tools</code> it stays the same, when I try <code>pip install git+https://github.com/NCAR/pop-tools.git</code> it gives me this error: </p>
<div class="codehilite"><pre><span></span><span class="o">(</span>analysis<span class="o">)</span> -bash-4.2$ pip install git+https://github.com/NCAR/pop-tools.git
Collecting git+https://github.com/NCAR/pop-tools.git
  Cloning https://github.com/NCAR/pop-tools.git to /glade/scratch/deppenme/pip-req-build-8etvcn_v
  Running <span class="nb">command</span> git clone -q https://github.com/NCAR/pop-tools.git /glade/scratch/deppenme/pip-req-build-8etvcn_v
  Installing build dependencies ... <span class="k">done</span>
  Getting requirements to build wheel ... <span class="k">done</span>
  Installing backend dependencies ... <span class="k">done</span>
    Preparing wheel metadata ... <span class="k">done</span>
Requirement already satisfied: dask&gt;<span class="o">=</span><span class="m">2</span>.14 in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">2021</span>.2.0<span class="o">)</span>
Requirement already satisfied: pyyaml&gt;<span class="o">=</span><span class="m">5</span>.3.1 in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">5</span>.4.1<span class="o">)</span>
Collecting numba&gt;<span class="o">=</span><span class="m">0</span>.52
  Using cached numba-0.52.0-cp37-cp37m-manylinux2014_x86_64.whl <span class="o">(</span><span class="m">3</span>.2 MB<span class="o">)</span>
Requirement already satisfied: xarray&gt;<span class="o">=</span><span class="m">0</span>.16.1 in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">0</span>.17.1.dev3+g48378c4<span class="o">)</span>
Requirement already satisfied: numpy&gt;<span class="o">=</span><span class="m">1</span>.17.0 in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">1</span>.19.5<span class="o">)</span>
Requirement already satisfied: pooch&gt;<span class="o">=</span><span class="m">1</span>.3.0 in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">1</span>.3.0<span class="o">)</span>
Requirement already satisfied: setuptools in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from numba&gt;<span class="o">=</span><span class="m">0</span>.52-&gt;pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">49</span>.6.0.post20210108<span class="o">)</span>
Collecting llvmlite&lt;<span class="m">0</span>.36,&gt;<span class="o">=</span><span class="m">0</span>.35.0
  Using cached llvmlite-0.35.0-cp37-cp37m-manylinux2010_x86_64.whl <span class="o">(</span><span class="m">25</span>.3 MB<span class="o">)</span>
Requirement already satisfied: requests in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from pooch&gt;<span class="o">=</span><span class="m">1</span>.3.0-&gt;pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">2</span>.25.1<span class="o">)</span>
Requirement already satisfied: packaging in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from pooch&gt;<span class="o">=</span><span class="m">1</span>.3.0-&gt;pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">20</span>.9<span class="o">)</span>
Requirement already satisfied: appdirs in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from pooch&gt;<span class="o">=</span><span class="m">1</span>.3.0-&gt;pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">1</span>.4.4<span class="o">)</span>
Requirement already satisfied: pandas&gt;<span class="o">=</span><span class="m">0</span>.25 in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from xarray&gt;<span class="o">=</span><span class="m">0</span>.16.1-&gt;pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">1</span>.2.3<span class="o">)</span>
Requirement already satisfied: python-dateutil&gt;<span class="o">=</span><span class="m">2</span>.7.3 in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from pandas&gt;<span class="o">=</span><span class="m">0</span>.25-&gt;xarray&gt;<span class="o">=</span><span class="m">0</span>.16.1-&gt;pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">2</span>.8.1<span class="o">)</span>
Requirement already satisfied: pytz&gt;<span class="o">=</span><span class="m">2017</span>.3 in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from pandas&gt;<span class="o">=</span><span class="m">0</span>.25-&gt;xarray&gt;<span class="o">=</span><span class="m">0</span>.16.1-&gt;pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">2021</span>.1<span class="o">)</span>
Requirement already satisfied: six&gt;<span class="o">=</span><span class="m">1</span>.5 in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from python-dateutil&gt;<span class="o">=</span><span class="m">2</span>.7.3-&gt;pandas&gt;<span class="o">=</span><span class="m">0</span>.25-&gt;xarray&gt;<span class="o">=</span><span class="m">0</span>.16.1-&gt;pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">1</span>.15.0<span class="o">)</span>
Requirement already satisfied: pyparsing&gt;<span class="o">=</span><span class="m">2</span>.0.2 in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from packaging-&gt;pooch&gt;<span class="o">=</span><span class="m">1</span>.3.0-&gt;pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">2</span>.4.7<span class="o">)</span>
Requirement already satisfied: chardet&lt;<span class="m">5</span>,&gt;<span class="o">=</span><span class="m">3</span>.0.2 in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from requests-&gt;pooch&gt;<span class="o">=</span><span class="m">1</span>.3.0-&gt;pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">4</span>.0.0<span class="o">)</span>
Requirement already satisfied: urllib3&lt;<span class="m">1</span>.27,&gt;<span class="o">=</span><span class="m">1</span>.21.1 in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from requests-&gt;pooch&gt;<span class="o">=</span><span class="m">1</span>.3.0-&gt;pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">1</span>.26.3<span class="o">)</span>
Requirement already satisfied: certifi&gt;<span class="o">=</span><span class="m">2017</span>.4.17 in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from requests-&gt;pooch&gt;<span class="o">=</span><span class="m">1</span>.3.0-&gt;pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">2020</span>.12.5<span class="o">)</span>
Requirement already satisfied: idna&lt;<span class="m">3</span>,&gt;<span class="o">=</span><span class="m">2</span>.5 in /glade/work/deppenme/miniconda3/envs/analysis/lib/python3.7/site-packages <span class="o">(</span>from requests-&gt;pooch&gt;<span class="o">=</span><span class="m">1</span>.3.0-&gt;pop-tools<span class="o">==</span><span class="m">2020</span>.12.15<span class="o">)</span> <span class="o">(</span><span class="m">2</span>.10<span class="o">)</span>
Building wheels <span class="k">for</span> collected packages: pop-tools
  Building wheel <span class="k">for</span> pop-tools <span class="o">(</span>PEP <span class="m">517</span><span class="o">)</span> ... <span class="k">done</span>
  Created wheel <span class="k">for</span> pop-tools: <span class="nv">filename</span><span class="o">=</span>pop_tools-2020.12.15-py3-none-any.whl <span class="nv">size</span><span class="o">=</span><span class="m">30153</span> <span class="nv">sha256</span><span class="o">=</span>988c711795c5b46037a868957be10d82f56fab4eab935b862cbc8c054f5f7717
  Stored in directory: /glade/scratch/deppenme/pip-ephem-wheel-cache-bdpxkpi5/wheels/65/87/a3/7667dcc7225e5105e95e09186af11e0befb140c2779fc074cf
Successfully built pop-tools
Installing collected packages: llvmlite, numba, pop-tools
  Attempting uninstall: llvmlite
    Found existing installation: llvmlite <span class="m">0</span>.31.0
ERROR: Cannot uninstall <span class="s1">&#39;llvmlite&#39;</span>. It is a distutils installed project and thus we cannot accurately determine which files belong to it which would lead to only a partial uninstall.
</pre></div>


<p>Anyway, I believe the issue is in principle with xgcm (see the <code>.grid</code> problem), so I tried to at least get that to the same version on both systems. Both seem to be installed by conda-forge</p>
<div class="codehilite"><pre><span></span>conda_analysis_casper.txt:xgcm                      <span class="m">0</span>.3.0                      py_0    conda-forge
conda_dcpy_andre.txt:xgcm                      <span class="m">0</span>.5.1                      py_0    conda-forge
</pre></div>


<p>and when I try to update with conda-forge it says it's already installed and doesn't change the version. </p>
<p>Long story short: help please. <span class="user-mention" data-user-id="25">@Deepak Cherian</span> <span class="user-mention" data-user-id="13">@Anderson Banihirwe</span>  any ideas?</p>



<a name="26173"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26173" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deepak Cherian <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26173">(Mar 03 2021 at 19:59)</a>:</h4>
<p>Yes this is an xgcm version problem. <code>conda update</code> should fix it, are you getting some other error in that case?</p>



<a name="26174"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26174" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26174">(Mar 03 2021 at 20:05)</a>:</h4>
<p>I keep doing <code>conda update</code> and it doesn't change the version. </p>
<div class="codehilite"><pre><span></span><span class="o">(</span>analysis<span class="o">)</span> -bash-4.2$ conda update xgcm
Collecting package metadata <span class="o">(</span>current_repodata.json<span class="o">)</span>: <span class="k">done</span>
Solving environment: <span class="k">done</span>

<span class="c1"># All requested packages already installed.</span>

<span class="o">(</span>analysis<span class="o">)</span> -bash-4.2$
</pre></div>



<a name="26175"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26175" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26175">(Mar 03 2021 at 20:06)</a>:</h4>
<p>same with <code>conda update -c conda-forge xgcm</code></p>



<a name="26177"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26177" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26177">(Mar 03 2021 at 21:00)</a>:</h4>
<p><span class="user-mention" data-user-id="27">@Anna-Lena Deppenmeier</span>, I think the issue is coming from an incompatible <code>docrep</code> version... Try pinning <code>docrep</code> to <code>v0.2.7</code></p>



<a name="26178"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26178" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26178">(Mar 03 2021 at 21:00)</a>:</h4>
<div class="codehilite"><pre><span></span>conda install -c conda-forge <span class="nv">docrep</span><span class="o">==</span><span class="m">0</span>.2.7
</pre></div>



<a name="26179"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26179" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26179">(Mar 03 2021 at 21:01)</a>:</h4>
<p>yes, I have come across the docrep problem.  it is currently at 0.2.7<br>
<code>docrep                    0.2.7                    pypi_0    pypi</code></p>
<p>am doing the conda install thing now and will then try a conda update xgcm again.</p>



<a name="26180"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26180" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26180">(Mar 03 2021 at 21:06)</a>:</h4>
<p>it's thinking really hard and currently hangs at </p>
<div class="codehilite"><pre><span></span><span class="o">(</span>analysis<span class="o">)</span> -bash-4.2$ conda install -c conda-forge <span class="nv">docrep</span><span class="o">==</span><span class="m">0</span>.2.7
Collecting package metadata <span class="o">(</span>current_repodata.json<span class="o">)</span>: <span class="k">done</span>
Solving environment: -
The environment is inconsistent, please check the package plan carefully
The following packages are causing the inconsistency:

  - conda-forge/linux-64::psyplot<span class="o">==</span><span class="m">1</span>.3.1<span class="o">=</span>py37h89c1867_0
  - conda-forge/noarch::xrft<span class="o">==</span><span class="m">0</span>.2.3<span class="o">=</span>pyhd3deb0d_0
  - conda-forge/noarch::funcargparse<span class="o">==</span><span class="m">0</span>.2.3<span class="o">=</span>pyh9f0ad1d_0
failed with initial frozen solve. Retrying with flexible solve.
Solving environment: <span class="p">|</span>
</pre></div>


<p>what can I do about the inconsistent environment?</p>



<a name="26182"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26182" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26182">(Mar 03 2021 at 21:09)</a>:</h4>
<p>ok it took a while but it worked and I was able to update xgcm. Thanks <span class="user-mention" data-user-id="13">@Anderson Banihirwe</span> ! And while you're here (; I am initializing my cluster like this </p>
<div class="codehilite"><pre><span></span><span class="c1"># this is for when you do things on casper</span>
<span class="kn">import</span> <span class="nn">ncar_jobqueue</span>
<span class="kn">import</span> <span class="nn">dask</span>
<span class="kn">import</span> <span class="nn">distributed</span>

<span class="n">dask</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">({</span><span class="s1">&#39;distributed.dashboard.link&#39;</span><span class="p">:</span> <span class="s1">&#39;/proxy/</span><span class="si">{port}</span><span class="s1">/status&#39;</span><span class="p">})</span>
<span class="n">cluster</span> <span class="o">=</span> <span class="n">ncar_jobqueue</span><span class="o">.</span><span class="n">NCARCluster</span><span class="p">()</span> <span class="c1"># initializes cluster</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">distributed</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>

<span class="n">cluster</span><span class="o">.</span><span class="n">adapt</span><span class="p">(</span><span class="n">minimum</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">wait_count</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span> <span class="c1"># gets you 6 workers minimum, max</span>
                                                     <span class="c1"># makes them wait 10 minutes before releasing</span>
<span class="n">client</span>
</pre></div>


<p>but I can't see my dashboard when I click on the link, what am I doing wrong?</p>



<a name="26186"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26186" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26186">(Mar 03 2021 at 21:42)</a>:</h4>
<p>what version of <code>ncar-jobqueue</code> are you using?</p>



<a name="26187"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26187" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26187">(Mar 03 2021 at 21:42)</a>:</h4>
<p>With the newest version of ncar-jobqueue, you don't need this </p>
<div class="codehilite"><pre><span></span><span class="n">dask</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">({</span><span class="s1">&#39;distributed.dashboard.link&#39;</span><span class="p">:</span> <span class="s1">&#39;/proxy/</span><span class="si">{port}</span><span class="s1">/status&#39;</span><span class="p">})</span>
</pre></div>



<a name="26189"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26189" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26189">(Mar 03 2021 at 21:44)</a>:</h4>
<p>'2020.3.4'</p>



<a name="26190"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26190" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26190">(Mar 03 2021 at 21:45)</a>:</h4>
<p>so when I remove the line and click on the new link. it wants to log into jupyterhub, which I am not using in the first place</p>



<a name="26191"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26191" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26191">(Mar 03 2021 at 21:45)</a>:</h4>
<blockquote>
<p>it's thinking really hard and currently hangs at </p>
</blockquote>
<p>You may find <code>mamba</code> to be very useful in this kind of situations </p>
<div class="codehilite"><pre><span></span>conda install -c conda-forge mamba<span class="sb">`</span><span class="c1">#  in your base</span>
</pre></div>


<p>and whenever you want to install packages via conda, replace <code>conda</code> with <code>mamba</code>. E.g.:  <code>mamba install -c conda-forge docrep==0.2.7</code></p>



<a name="26192"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26192" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26192">(Mar 03 2021 at 21:46)</a>:</h4>
<blockquote>
<p>'2020.3.4'</p>
</blockquote>
<p>That's old</p>



<a name="26193"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26193" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26193">(Mar 03 2021 at 21:46)</a>:</h4>
<p>Try the latest version <code>2021.2.10</code></p>



<a name="26194"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26194" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26194">(Mar 03 2021 at 21:46)</a>:</h4>
<div class="codehilite"><pre><span></span>conda install -c conda-forge ncar-jobqueue<span class="o">==</span><span class="m">2021</span>.2.10
</pre></div>



<a name="26195"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26195" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26195">(Mar 03 2021 at 21:47)</a>:</h4>
<p>hm. I did a conda update all in the beginning of the day, because I haven't worked on casper in a while, I wonder why it didn't update it.</p>



<a name="26198"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26198" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26198">(Mar 03 2021 at 21:48)</a>:</h4>
<p>Is there a running documentary somewhere where we keep the current versions? So for example I am mostly working on the cgd system these days, and whenever I switch back to casper I am having these issues and have to ask people (partly because <code>conda update all</code> does not seem to take care of these things?)<br>
but anyhow I updated and I still get [pasted image] upon clicking on the link  (<a href="user_uploads/2/43/qRHGVdyfK9fAaORJ5dlfqOn8/pasted_image.png" target="_blank" title="user_uploads/2/43/qRHGVdyfK9fAaORJ5dlfqOn8/pasted_image.png">https://zulip2.cloud.ucar.edu/user_uploads/2/43/qRHGVdyfK9fAaORJ5dlfqOn8/pasted_image.png</a>)</p>
<div class="message_inline_image"><a href="user_uploads/2/43/qRHGVdyfK9fAaORJ5dlfqOn8/pasted_image.png" target="_blank" title="https://zulip2.cloud.ucar.edu/user_uploads/2/43/qRHGVdyfK9fAaORJ5dlfqOn8/pasted_image.png"><img src="user_uploads/2/43/qRHGVdyfK9fAaORJ5dlfqOn8/pasted_image.png"></a></div>



<a name="26199"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26199" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26199">(Mar 03 2021 at 21:52)</a>:</h4>
<blockquote>
<p>hm. I did a conda update all in the beginning of the day, because I haven't worked on casper in a while, I wonder why it didn't update it.</p>
</blockquote>
<p>the conda solver is very flexible unless you pin down which versions you want.. It's hard to control this when you've installed packages via <code>conda install ...</code> command. one remedy is to curate your environment in a <code>environment.yml</code> and then run <code>conda env update -f environment.yml</code> command whenever you want to update... (With this approach, it's easy to control which versions get installed)</p>



<a name="26200"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26200" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26200">(Mar 03 2021 at 21:52)</a>:</h4>
<blockquote>
<p>Is there a running documentary somewhere where we keep the current versions? So for example I am mostly working on the cgd system these days, and whenever I switch back to casper I am having these issues and have to ask people (partly because <code>conda update all</code> does not seem to take care of these things?)<br>
but anyhow I updated and I still get [pasted image] upon clicking on the link  (<a href="user_uploads/2/43/qRHGVdyfK9fAaORJ5dlfqOn8/pasted_image.png" target="_blank" title="user_uploads/2/43/qRHGVdyfK9fAaORJ5dlfqOn8/pasted_image.png">https://zulip2.cloud.ucar.edu/user_uploads/2/43/qRHGVdyfK9fAaORJ5dlfqOn8/pasted_image.png</a>)</p>
</blockquote>
<p>This looks very familiar</p>



<a name="26201"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26201" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26201">(Mar 03 2021 at 21:52)</a>:</h4>
<p>This is likely a version mismatch</p>



<a name="26202"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26202" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26202">(Mar 03 2021 at 21:53)</a>:</h4>
<blockquote>
<blockquote>
<p>hm. I did a conda update all in the beginning of the day, because I haven't worked on casper in a while, I wonder why it didn't update it.</p>
</blockquote>
<p>the conda solver is very flexible unless you pin down which versions you want.. It's hard to control this when you've installed packages via <code>conda install ...</code> command. one remedy is to curate your environment in a <code>environment.yml</code> and then run <code>conda env update -f environment.yml</code> command whenever you want to update... (With this approach, it's easy to control which versions get installed)</p>
</blockquote>
<p>I don't understand what you mean with curate -- like I literally go in and find the version numbers I need?</p>



<a name="26203"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26203" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26203">(Mar 03 2021 at 21:55)</a>:</h4>
<p>tbh that doesn't sound very easy to me at all. I thought it was the idea to be able to use <code>conda install</code>and then get the latest version if I don't specify which version I want with the <code>==</code>?</p>



<a name="26206"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26206" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26206">(Mar 03 2021 at 22:00)</a>:</h4>
<blockquote>
<p>I don't understand what you mean with curate -- like I literally go in and find the version numbers I need? </p>
</blockquote>
<p>For instance, if you were starting with a new environment, you would create a new <code>environment.yml</code> file. The original contents of this file may look like this: </p>
<div class="codehilite"><pre><span></span><span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-new-env</span>
<span class="nt">channels</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">conda-forge</span>
<span class="nt">dependencies</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">python=3.8</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">xarray==0.16.2</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dask==2.14</span>
</pre></div>


<p>To create/update this environment, you would run <code>conda env update -f environment.yml</code></p>
<p>If let's say a week later, you decide that you want to upgrade one or more dependencies in this environment, you need to go back to the <code>environment.yml</code> file and update it, e.g. </p>
<div class="codehilite"><pre><span></span><span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-new-env</span>
<span class="nt">channels</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">conda-forge</span>
<span class="nt">dependencies</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">python=3.8</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">xarray==0.17</span> <span class="c1"># Upgrade to latest version of xarray</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dask==2.14</span>
</pre></div>


<p>At this point, you would then run <code>conda env update -f environment.yml</code> </p>
<p>With this approach, you can have an idea of what versions of packages you care about are installed in your environment by looking at your environment.yml file and you can <em>easily</em> re-create this environment on the same machine or another machine with the same type of operating system (Linux, MacOS, etc...). This is what I mean by environment curation.</p>



<a name="26207"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26207" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26207">(Mar 03 2021 at 22:00)</a>:</h4>
<p>I hope this clarifies my previous point</p>



<a name="26208"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26208" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26208">(Mar 03 2021 at 22:01)</a>:</h4>
<p>Regarding the version mismatch issue, what is the output of </p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">dask</span><span class="o">,</span> <span class="nn">distributed</span><span class="o">,</span> <span class="nn">bokeh</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dask</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="n">distributed</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="n">bokeh</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>


<p>from your notebook??</p>



<a name="26211"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26211" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26211">(Mar 03 2021 at 22:04)</a>:</h4>
<blockquote>
<p>I hope this clarifies my previous point</p>
</blockquote>
<p>It does, thanks. I am not sure whether I would be able to do that though. It seems like I would be on top of every package version I would want to use, which seems like a lot to research / keep in mind. Anyway.</p>
<p>The output is <code>2021.02.0 2021.02.0 2.3.0</code></p>
<p>I also just tried pushing my notebook to git and it says I am denied </p>
<div class="codehilite"><pre><span></span>Username for &#39;https://github.com&#39;: ALDepp
Password for &#39;https://ALDepp@github.com&#39;:
remote: Permission to NCAR/pop-tools.git denied to ALDepp.
fatal: unable to access &#39;https://github.com/NCAR/pop-tools.git/&#39;: The requested URL returned error: 403
</pre></div>



<a name="26212"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26212" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26212">(Mar 03 2021 at 22:06)</a>:</h4>
<blockquote>
<p>The output is 2021.02.0 2021.02.0 2.3.0 </p>
</blockquote>
<p>Try pinning your dask, distributed, bokeh versions to these versions:</p>
<div class="codehilite"><pre><span></span>dask==2.14
distributed==2.14
bokeh==1.4
</pre></div>



<a name="26213"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26213" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26213">(Mar 03 2021 at 22:09)</a>:</h4>
<blockquote>
<p>I also just tried pushing my notebook to git and it says I am denied </p>
</blockquote>
<p>I think you want to push to your fork (<a href="https://github.com/ALDepp/pop-tools" target="_blank" title="https://github.com/ALDepp/pop-tools">https://github.com/ALDepp/pop-tools</a>) repo and open a pull request to merge your changes into NCAR/pop-tools</p>



<a name="26214"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26214" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26214">(Mar 03 2021 at 22:10)</a>:</h4>
<p>Can you confirm your git repo is pointed to the right remote endpoint?</p>



<a name="26215"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26215" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26215">(Mar 03 2021 at 22:10)</a>:</h4>
<p>Try this</p>



<a name="26216"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26216" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26216">(Mar 03 2021 at 22:10)</a>:</h4>
<div class="codehilite"><pre><span></span>git remote -v
</pre></div>



<a name="26222"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26222" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26222">(Mar 03 2021 at 22:13)</a>:</h4>
<blockquote>
<blockquote>
<p>I also just tried pushing my notebook to git and it says I am denied </p>
</blockquote>
<p>I think you want to push to your fork (<a href="https://github.com/ALDepp/pop-tools" target="_blank" title="https://github.com/ALDepp/pop-tools">https://github.com/ALDepp/pop-tools</a>) repo and open a pull request to merge your changes into NCAR/pop-tools</p>
</blockquote>
<p>yes, thank you (:</p>



<a name="26223"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26223" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26223">(Mar 03 2021 at 22:23)</a>:</h4>
<blockquote>
<div class="codehilite"><pre><span></span>git remote -v
</pre></div>


</blockquote>
<div class="codehilite"><pre><span></span>origin  https://github.com/ALDepp/pop-tools.git (fetch)
origin  https://github.com/ALDepp/pop-tools.git (push)
upstream    https://github.com/NCAR/pop-tools.git (fetch)
upstream    https://github.com/NCAR/pop-tools.git (push)
</pre></div>



<a name="26245"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26245" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26245">(Mar 04 2021 at 16:19)</a>:</h4>
<blockquote>
<blockquote>
<p>The output is 2021.02.0 2021.02.0 2.3.0 </p>
</blockquote>
<p>Try pinning your dask, distributed, bokeh versions to these versions:</p>
</blockquote>
<p>dask==2.14<br>
distributed==2.14<br>
bokeh==1.4<br>
I have not been able to pin bokeh to 1.4. It took a very long time and then gave me a very long list of packages that conflict, and in the end says</p>
<div class="codehilite"><pre><span></span>Your installed version is: 2.17
</pre></div>



<a name="26246"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26246" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26246">(Mar 04 2021 at 16:29)</a>:</h4>
<p>Could you point me to the location of this conda environment?</p>



<a name="26247"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26247" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26247">(Mar 04 2021 at 16:50)</a>:</h4>
<p>/glade/work/deppenme/miniconda3/envs/analysis</p>



<a name="26721"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26721" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassir Eddebbar <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26721">(Mar 12 2021 at 17:46)</a>:</h4>
<p>I am wondering if it could be helpful to users not deeply familiar with the POP grid to add an illustration/visualization in <span class="user-mention" data-user-id="27">@Anna-Lena Deppenmeier</span> 's notebook on where the various terms sit in the grid cell, what the various terms mean. This what I found most challenging in creating the budget terms... I started on something a few months ago on illustrator that can be edited for this purpose (needs QA/QC review for accuracy):  <br>
<a href="/user_uploads/2/8a/cyIi14CbPhepCrFP2zBALrjs/POP_Grid.png" target="_blank" title="POP_Grid.png">POP_Grid.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/8a/cyIi14CbPhepCrFP2zBALrjs/POP_Grid.png" target="_blank" title="POP_Grid.png"><img src="/user_uploads/2/8a/cyIi14CbPhepCrFP2zBALrjs/POP_Grid.png"></a></div>



<a name="26722"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26722" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deepak Cherian <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26722">(Mar 12 2021 at 17:47)</a>:</h4>
<p>yes please! very cool image</p>



<a name="26723"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26723" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deepak Cherian <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26723">(Mar 12 2021 at 17:49)</a>:</h4>
<p>if you have html/svg skills you could add this to xgcm: <a href="https://github.com/xgcm/xgcm/issues/276" target="_blank" title="https://github.com/xgcm/xgcm/issues/276">https://github.com/xgcm/xgcm/issues/276</a></p>



<a name="26724"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26724" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Grover <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26724">(Mar 12 2021 at 17:49)</a>:</h4>
<p>Would be good to add to pop-tools as well?</p>



<a name="26725"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26725" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26725">(Mar 12 2021 at 17:50)</a>:</h4>
<p><span class="user-mention" data-user-id="84">@Yassir Eddebbar</span>   I think that would be useful. Are v.t and u.t consistent in this figure? one seems to be on the corner and one on the face</p>



<a name="26726"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26726" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26726">(Mar 12 2021 at 17:50)</a>:</h4>
<p><span class="user-mention" data-user-id="84">@Yassir Eddebbar</span>  is it okay if I add this to the example notebook (since casper is up again I aim to make changes and resubmit today)</p>



<a name="26730"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26730" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassir Eddebbar <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26730">(Mar 12 2021 at 17:56)</a>:</h4>
<blockquote>
<p><span class="user-mention silent" data-user-id="84">Yassir Eddebbar</span>  is it okay if I add this to the example notebook (since casper is up again I aim to make changes and resubmit today)</p>
</blockquote>
<p>Yes, as long as it looks ok by you and others accuracy wise, go for it. Happy to edit some later</p>



<a name="26732"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26732" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassir Eddebbar <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26732">(Mar 12 2021 at 18:01)</a>:</h4>
<blockquote>
<p><span class="user-mention silent" data-user-id="84">Yassir Eddebbar</span>   I think that would be useful. Are v.t and u.t consistent in this figure? one seems to be on the corner and one on the face</p>
</blockquote>
<p>yeah, I struggled with how to represent v.t , it's supposed to look like it's popping out the center of the northern cell face (location 3121) not corner, but now looking at it, it can be confused for the SE upper corner...  I can work something better later?</p>



<a name="26734"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26734" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassir Eddebbar <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26734">(Mar 12 2021 at 18:03)</a>:</h4>
<blockquote>
<p>if you have html/svg skills you could add this to xgcm: <a href="https://github.com/xgcm/xgcm/issues/276" target="_blank" title="https://github.com/xgcm/xgcm/issues/276">https://github.com/xgcm/xgcm/issues/276</a></p>
</blockquote>
<p><span class="user-mention" data-user-id="25">@Deepak Cherian</span>  I'll look into it, not familiar with svg yet, but sounds like it could be really useful for xgcm.</p>



<a name="26744"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/26744" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassir Eddebbar <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#26744">(Mar 12 2021 at 20:02)</a>:</h4>
<p><span class="user-mention" data-user-id="27">@Anna-Lena Deppenmeier</span>  Here is an updated version with more POP-consistent naming and a legend: <a href="/user_uploads/2/55/D-_J312vUywrdY4HT9t7jvSv/POP_Grid.png" target="_blank" title="POP_Grid.png">POP_Grid.png</a><br>
<span class="user-mention" data-user-id="134">@Max Grover</span>  Feel free to use on pop-tools doc or elsewhere, and let me know if you need any edits or additions for other uses, I can also send over the .ai file</p>
<div class="message_inline_image"><a href="/user_uploads/2/55/D-_J312vUywrdY4HT9t7jvSv/POP_Grid.png" target="_blank" title="POP_Grid.png"><img src="/user_uploads/2/55/D-_J312vUywrdY4HT9t7jvSv/POP_Grid.png"></a></div>



<a name="27053"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/27053" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deepak Cherian <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#27053">(Mar 17 2021 at 14:03)</a>:</h4>
<p>Just an update: This awesome notebooks is now <a href="https://pop-tools.readthedocs.io/en/latest/examples/CloseHeatBudget_POP2.html" target="_blank" title="https://pop-tools.readthedocs.io/en/latest/examples/CloseHeatBudget_POP2.html">live</a> thanks to <span class="user-mention" data-user-id="27">@Anna-Lena Deppenmeier</span> <span class="user-mention" data-user-id="84">@Yassir Eddebbar</span> <span class="user-mention" data-user-id="13">@Anderson Banihirwe</span> .</p>



<a name="31826"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/31826" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Who Kim <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#31826">(May 18 2021 at 21:39)</a>:</h4>
<p>I am trying to expanding this awesome notebook to work for prediction datasets (in particular DPLE). Thanks to Anderson, now <code>to_xgcm_grid_dataset()</code> can handle the DPEL dimensions (time, lead, ensemble, z, y, x). But, when I try to compute the buget term using  in Z direction, ie.,</p>
<div class="codehilite"><pre><span></span><span class="n">budget</span><span class="p">[</span><span class="s2">&quot;WTT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">gridxgcm</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dsxgcm</span><span class="o">.</span><span class="n">WTT</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">dsxgcm</span><span class="o">.</span><span class="n">VOL</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">dsxgcm</span><span class="o">.</span><span class="n">VOL</span><span class="p">)</span>
</pre></div>


<p>, I got the following error, while working fine in X and Y directions: "None of the DataArray's dims ('Y', 'M', 'L', 'z_w_top', 'nlat_t', 'nlon_t') were found in axis coords." Can anone help me to figure out how to fix this problem? Thanks!</p>



<a name="31832"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/31832" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#31832">(May 19 2021 at 15:41)</a>:</h4>
<p>Hi Who, on which coordinate is WTT? I'm assuming VOL is on z_t and WTT on z_w_bot or z_w_top</p>



<a name="31833"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/31833" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#31833">(May 19 2021 at 15:41)</a>:</h4>
<p>If that is the case then you need to either reasign / rename the coordinate or interpolate first for xgcm to want to mulitply WTT with VOL.</p>



<a name="31868"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/31868" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassir Eddebbar <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#31868">(May 19 2021 at 17:35)</a>:</h4>
<p><span class="user-mention" data-user-id="51">@Who Kim</span>  can you paste your code for how you set up your grid, vertical thickness, volume, etc?</p>



<a name="31902"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/31902" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Who Kim <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#31902">(May 19 2021 at 20:31)</a>:</h4>
<p><span class="user-mention" data-user-id="27">@Anna-Lena Deppenmeier</span>  I have tried that, but didn't work (I forget what was the error messsage). In fact, this line is same as in your original script and only the difference is that WTT has now more coornidates.  Doesn't <code>dsxgcm.VOL.values</code> makes it free from its assigned coordinates?</p>
<p><span class="user-mention" data-user-id="84">@Yassir Eddebbar</span> Below is how I set up those, which is similar to the Anna's script with some modifications,</p>
<div class="codehilite"><pre><span></span><span class="n">dple</span><span class="p">[</span><span class="s2">&quot;DZT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">dple</span><span class="o">.</span><span class="n">dz</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">dple</span><span class="o">.</span><span class="n">dz</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">dple</span><span class="o">.</span><span class="n">nlat</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">dple</span><span class="o">.</span><span class="n">nlon</span><span class="p">)))</span>
                <span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;z_t&#39;</span><span class="p">,</span><span class="s1">&#39;nlat&#39;</span><span class="p">,</span><span class="s1">&#39;nlon&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;z_t&#39;</span><span class="p">:</span><span class="n">dple</span><span class="o">.</span><span class="n">z_t</span><span class="p">,</span><span class="s1">&#39;nlat&#39;</span><span class="p">:</span><span class="n">dple</span><span class="o">.</span><span class="n">nlat</span><span class="p">,</span><span class="s1">&#39;nlon&#39;</span><span class="p">:</span><span class="n">dple</span><span class="o">.</span><span class="n">nlon</span><span class="p">})</span>
<span class="n">dple</span><span class="p">[</span><span class="s2">&quot;DZU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">dple</span><span class="o">.</span><span class="n">dz</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">dple</span><span class="o">.</span><span class="n">dz</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">dple</span><span class="o">.</span><span class="n">nlat</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">dple</span><span class="o">.</span><span class="n">nlon</span><span class="p">)))</span>
                <span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;z_t&#39;</span><span class="p">,</span><span class="s1">&#39;nlat&#39;</span><span class="p">,</span><span class="s1">&#39;nlon&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;z_t&#39;</span><span class="p">:</span><span class="n">dple</span><span class="o">.</span><span class="n">z_t</span><span class="p">,</span><span class="s1">&#39;nlat&#39;</span><span class="p">:</span><span class="n">dple</span><span class="o">.</span><span class="n">nlat</span><span class="p">,</span><span class="s1">&#39;nlon&#39;</span><span class="p">:</span><span class="n">dple</span><span class="o">.</span><span class="n">nlon</span><span class="p">})</span>

<span class="n">dple</span><span class="o">.</span><span class="n">DZT</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Thickness of T cells&quot;</span>
<span class="n">dple</span><span class="o">.</span><span class="n">DZT</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;centimeter&quot;</span>
<span class="n">dple</span><span class="o">.</span><span class="n">DZT</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;grid_loc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;3111&quot;</span>
<span class="n">dple</span><span class="o">.</span><span class="n">DZU</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Thickness of U cells&quot;</span>
<span class="n">dple</span><span class="o">.</span><span class="n">DZU</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;centimeter&quot;</span>
<span class="n">dple</span><span class="o">.</span><span class="n">DZU</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;grid_loc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;3221&quot;</span>

<span class="c1"># make sure we have the cell volumne for calculations</span>
<span class="n">VOL</span> <span class="o">=</span> <span class="p">(</span><span class="n">dple</span><span class="o">.</span><span class="n">DZT</span> <span class="o">*</span> <span class="n">dple</span><span class="o">.</span><span class="n">DXT</span> <span class="o">*</span> <span class="n">dple</span><span class="o">.</span><span class="n">DYT</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="n">KMT</span> <span class="o">=</span> <span class="n">dple</span><span class="o">.</span><span class="n">KMT</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">KMT</span><span class="o">.</span><span class="n">nlat</span><span class="p">))):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">KMT</span><span class="o">.</span><span class="n">nlon</span><span class="p">)):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">KMT</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">VOL</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="n">dple</span><span class="p">[</span><span class="s2">&quot;VOL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VOL</span>

<span class="n">dple</span><span class="o">.</span><span class="n">VOL</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;volume of T cells&quot;</span>
<span class="n">dple</span><span class="o">.</span><span class="n">VOL</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;centimeter^3&quot;</span>

<span class="n">dple</span><span class="o">.</span><span class="n">VOL</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;grid_loc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;3111&quot;</span>
</pre></div>



<a name="31903"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/31903" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#31903">(May 19 2021 at 20:33)</a>:</h4>
<p>I didn't catch the <code>.values</code>, thanks for pointing that out. I'm not sure xgcm would multiply with <code>values</code> though, given that it uses the coordinates to determine how to multiply. Usually it looks for the same coordinates to know how to multiply.</p>



<a name="31911"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/31911" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Who Kim <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#31911">(May 19 2021 at 20:38)</a>:</h4>
<p>Below is the codes from your script. I can compute UET and VNT using the same codes without any problems. Is there a reason why you multify (dz<em>dxt</em>dyt).values for WTT insead of VOL.values? I think I tried that, but I can try again with your original formula.</p>
<div class="codehilite"><pre><span></span><span class="n">budget</span><span class="p">[</span><span class="s2">&quot;UET&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">gridxgcm</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dsxgcm</span><span class="o">.</span><span class="n">UET</span> <span class="o">*</span> <span class="n">dsxgcm</span><span class="o">.</span><span class="n">VOL</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">dsxgcm</span><span class="o">.</span><span class="n">VOL</span><span class="p">)</span>
<span class="n">budget</span><span class="p">[</span><span class="s2">&quot;VNT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">gridxgcm</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dsxgcm</span><span class="o">.</span><span class="n">VNT</span> <span class="o">*</span> <span class="n">dsxgcm</span><span class="o">.</span><span class="n">VOL</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">dsxgcm</span><span class="o">.</span><span class="n">VOL</span><span class="p">)</span>
<span class="n">budget</span><span class="p">[</span><span class="s2">&quot;WTT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">gridxgcm</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dsxgcm</span><span class="o">.</span><span class="n">WTT</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dsxgcm</span><span class="o">.</span><span class="n">dz</span> <span class="o">*</span> <span class="n">dsxgcm</span><span class="o">.</span><span class="n">DXT</span> <span class="o">*</span> <span class="n">dsxgcm</span><span class="o">.</span><span class="n">DYT</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span>
    <span class="o">/</span> <span class="n">dsxgcm</span><span class="o">.</span><span class="n">VOL</span>
<span class="p">)</span>
</pre></div>



<a name="31915"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/31915" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassir Eddebbar <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#31915">(May 19 2021 at 21:05)</a>:</h4>
<p>Hmmm, how about the xgcm grid set up, any modification there? i.e. this part:</p>
<div class="codehilite"><pre><span></span>metrics = {
    (&quot;X&quot;,): [&quot;DXU&quot;, &quot;DXT&quot;],  # X distances
    (&quot;Y&quot;,): [&quot;DYU&quot;, &quot;DYT&quot;],  # Y distances
    (&quot;Z&quot;,): [&quot;DZU&quot;, &quot;DZT&quot;],  # Z distances
    (&quot;X&quot;, &quot;Y&quot;): [&quot;UAREA&quot;, &quot;TAREA&quot;],
}

# here we get the xgcm compatible dataset
gridxgcm, dsxgcm = pop_tools.to_xgcm_grid_dataset(
    ds,
    periodic=False,
    metrics=metrics,
    boundary={&quot;X&quot;: &quot;extend&quot;, &quot;Y&quot;: &quot;extend&quot;, &quot;Z&quot;: &quot;extend&quot;},
)

for coord in [&quot;nlat&quot;, &quot;nlon&quot;]:
    if coord in dsxgcm.coords:
        dsxgcm = dsxgcm.drop_vars(coord)
</pre></div>



<a name="31973"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/31973" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Who Kim <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#31973">(May 19 2021 at 23:00)</a>:</h4>
<p>It is exactly same.</p>



<a name="32006"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32006" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassir Eddebbar <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32006">(May 20 2021 at 15:49)</a>:</h4>
<p>Following on <span class="user-mention" data-user-id="27">@Anna-Lena Deppenmeier</span> 's reassigning coordinates idea, does an xr.roll / shift method work (just for debugging purposes)? something like:</p>
<div class="codehilite"><pre><span></span>di=xr.Dataset()
di[&#39;UET&#39;] = -((ds.UET*ds.VOL) - (ds.UET*ds.VOL).roll(nlon=1, roll_coords=True))/ds.VOL
di[&#39;VNT&#39;] = -((ds.VNT*ds.VOL) - (ds.VNT*ds.VOL).roll(nlat=1, roll_coords=True))/ds.VOL
di[&#39;WTT&#39;] = - ((ds.WTT*(ds.VOL.drop(&#39;z_t&#39;).rename({&quot;z_t&quot;:&quot;z_w_top&quot;}).assign_coords(z_w_top=ds.z_w_top))
                     - (ds.WTT*(ds.VOL.drop(&#39;z_t&#39;).rename({&quot;z_t&quot;:&quot;z_w_top&quot;}).assign_coords(z_w_top=ds.z_w_top))).shift(z_w_top=-1).fillna(0)
                    ).drop(&#39;z_w_top&#39;).rename({&quot;z_w_top&quot;:&quot;z_t&quot;}).assign_coords(z_t=ds.z_t))/ds.VOL
</pre></div>



<a name="32010"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32010" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Who Kim <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32010">(May 20 2021 at 16:38)</a>:</h4>
<p>It appears to be working (at least I didn't see any error). I have also generated a new VOL defined at z_w_top and added to dsxgcm, but I got the same error:</p>
<div class="codehilite"><pre><span></span><span class="n">dsxgcm</span><span class="p">[</span><span class="s2">&quot;VOL2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">dsxgcm</span><span class="o">.</span><span class="n">VOL</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;z_w_top&#39;</span><span class="p">,</span> <span class="s1">&#39;nlat_t&#39;</span><span class="p">,</span> <span class="s1">&#39;nlon_t&#39;</span><span class="p">],</span>
                              <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;z_w_top&#39;</span><span class="p">:</span><span class="n">dsxgcm</span><span class="o">.</span><span class="n">z_w_top</span><span class="p">,</span> <span class="s1">&#39;nlat_t&#39;</span><span class="p">:</span><span class="n">dsxgcm</span><span class="o">.</span><span class="n">nlat_t</span><span class="p">,</span> <span class="s1">&#39;nlon_t&#39;</span><span class="p">:</span><span class="n">dsxgcm</span><span class="o">.</span><span class="n">nlon_t</span><span class="p">})</span>

<span class="n">budget</span><span class="p">[</span><span class="s2">&quot;WTT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">gridxgcm</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dsxgcm</span><span class="o">.</span><span class="n">WTT</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">dsxgcm</span><span class="o">.</span><span class="n">VOL2</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span><span class="o">/</span><span class="n">dsxgcm</span><span class="o">.</span><span class="n">VOL</span><span class="p">)</span>

<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span>                                  <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">86</span><span class="o">-</span><span class="mf">192e3</span><span class="n">d3043c5</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
      <span class="mi">2</span> <span class="n">vol_top</span> <span class="o">=</span> <span class="n">vol_top</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;z_t&#39;</span><span class="p">:</span> <span class="s1">&#39;z_w_top&#39;</span><span class="p">})</span>
      <span class="mi">3</span>
<span class="o">----&gt;</span> <span class="mi">4</span> <span class="n">budget</span><span class="p">[</span><span class="s2">&quot;WTT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">gridxgcm</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dsxgcm</span><span class="o">.</span><span class="n">WTT</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">vol_top</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span><span class="o">/</span> <span class="n">dsxgcm</span><span class="o">.</span><span class="n">VOL</span><span class="p">)</span>

<span class="o">~/</span><span class="n">miniconda3</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">rapcdi</span><span class="o">-</span><span class="n">analysis</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">xgcm</span><span class="o">/</span><span class="n">grid</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">da</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
   <span class="mi">1483</span>         <span class="o">&gt;&gt;&gt;</span> <span class="n">grid</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">fill_value</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">})</span>
   <span class="mi">1484</span>         <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">-&gt; 1485         return self._grid_func(&quot;diff&quot;, da, axis, **kwargs)</span>
<span class="s2">   1486</span>
<span class="s2">   1487     @docstrings.dedent</span>

<span class="s2">~/miniconda3/envs/rapcdi-analysis/lib/python3.8/site-packages/xgcm/grid.py in _grid_func(self, funcname, da, axis, **kwargs)</span>
<span class="s2">   1419                 out = out * metric</span>
<span class="s2">   1420</span>
<span class="s2">-&gt; 1421             out = func(out, **kwargs)</span>
<span class="s2">   1422</span>
<span class="s2">   1423             if metric_weighted:</span>

<span class="s2">~/miniconda3/envs/rapcdi-analysis/lib/python3.8/site-packages/xgcm/grid.py in diff(self, da, to, boundary, fill_value, boundary_discontinuity, vector_partner, keep_coords)</span>
<span class="s2">    638         &quot;&quot;&quot;</span>
    <span class="mi">639</span>
<span class="o">--&gt;</span> <span class="mi">640</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_binary_func</span><span class="p">(</span>
    <span class="mi">641</span>             <span class="n">da</span><span class="p">,</span>
    <span class="mi">642</span>             <span class="n">raw_diff_function</span><span class="p">,</span>

<span class="o">~/</span><span class="n">miniconda3</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">rapcdi</span><span class="o">-</span><span class="n">analysis</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">xgcm</span><span class="o">/</span><span class="n">grid</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="n">_neighbor_binary_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">da</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">,</span> <span class="n">boundary_discontinuity</span><span class="p">,</span> <span class="n">vector_partner</span><span class="p">,</span> <span class="n">keep_coords</span><span class="p">)</span>
    <span class="mi">275</span>             <span class="n">The</span> <span class="n">differenced</span> <span class="n">data</span>
    <span class="mi">276</span>         <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">--&gt; 277         position_from, dim = self._get_axis_coord(da)</span>
<span class="s2">    278         if to is None:</span>
<span class="s2">    279             to = self._default_shifts[position_from]</span>

<span class="s2">~/miniconda3/envs/rapcdi-analysis/lib/python3.8/site-packages/xgcm/grid.py in _get_axis_coord(self, da)</span>
<span class="s2">   1013                 return position, coord_name</span>
<span class="s2">   1014</span>
<span class="s2">-&gt; 1015         raise KeyError(</span>
<span class="s2">   1016             &quot;None of the DataArray&#39;s dims </span><span class="si">%s</span><span class="s2"> were found in axis &quot;</span>
<span class="s2">   1017             &quot;coords.&quot; </span><span class="si">% r</span><span class="s2">epr(da.dims)</span>

<span class="s2">KeyError: &quot;None of the DataArray&#39;s dims (&#39;Y&#39;, &#39;M&#39;, &#39;L&#39;, &#39;z_w_top&#39;, &#39;nlat_t&#39;, &#39;nlon_t&#39;) were found in axis coords.&quot;</span>
</pre></div>



<a name="32012"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32012" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32012">(May 20 2021 at 16:49)</a>:</h4>
<p>Who, I don't know where the 'Y', 'M', 'L' dimenions are coming from. I recommend always checking your dimensions for the DataArrays, as they have to line up for xgcm to want to multiply.</p>



<a name="32013"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32013" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32013">(May 20 2021 at 16:50)</a>:</h4>
<p>also, you negate that you added dimensions to <code>VOL2</code> when you then use <code>.values</code>. it turns the xarray dataarray into a <code>numpy.ndarray</code> array.</p>



<a name="32014"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32014" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32014">(May 20 2021 at 16:56)</a>:</h4>
<p>Can you try with with just multiplying <code>VOL2</code> instead of <code>VOL2.values</code>?</p>



<a name="32015"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32015" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deepak Cherian <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32015">(May 20 2021 at 16:59)</a>:</h4>
<p>(I know I've asked this 50x before but I keep forgetting!) Why are we multiplying by <code>VOL.values</code>. Is it because there's a <code>z_w</code> and <code>z_w_top</code> mismatch?</p>



<a name="32036"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32036" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassir Eddebbar <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32036">(May 20 2021 at 19:21)</a>:</h4>
<p>I believe the mismatch was <code>z_t</code> and <code>z_w_top</code> since <code>WTT</code> is centered at the center of the upper face (3112) vs <code>VOL</code> is in the center of the cell (3111).</p>



<a name="32039"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32039" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassir Eddebbar <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32039">(May 20 2021 at 19:25)</a>:</h4>
<blockquote>
<p>Who, I don't know where the 'Y', 'M', 'L' dimensions are coming from. I recommend always checking your dimensions for the DataArrays, as they have to line up for xgcm to want to multiply.</p>
</blockquote>
<p>maybe xgcm is confused by the DPLE <code>Y</code> dimension? in:  </p>
<div class="codehilite"><pre><span></span>~/miniconda3/envs/rapcdi-analysis/lib/python3.8/site-packages/xgcm/grid.py in diff(self, da, axis, **kwargs)
   1483         &gt;&gt;&gt; grid.diff(da, [&#39;X&#39;, &#39;Y&#39;], fill_value={&#39;X&#39;:0, &#39;Y&#39;:100})
   1484         &quot;&quot;&quot;
-&gt; 1485         return self._grid_func(&quot;diff&quot;, da, axis, **kwargs)
   1486
   1487     @docstrings.dedent
</pre></div>


<p>copying <span class="user-mention" data-user-id="174">@Julius Busecke</span>  who helps develop <code>xgcm</code></p>



<a name="32047"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32047" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Who Kim <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32047">(May 20 2021 at 20:02)</a>:</h4>
<p><span class="user-mention" data-user-id="27">@Anna-Lena Deppenmeier</span> As I mentioned in my first post, I am working on DPLE data with Y, M, L being  the start year, ensemble memble, and lead time, respectively. I believe the reason why <code>.values</code> is used that UET and VNT are at (nlat_t, nlon_u) while VOL is at T-grid for both. If I don't use .values, I got: <code>broadcasting cannot handle duplicate dimensions: ['time', 'z_t', 'nlat_t', 'nlon_u', 'nlon_u']</code>. I though Anna used .values for a similar region because WTT is at z_w_top although it is at T-grid horizonally. If this logic is correct, I don't see any reason why this operation is not working for WTT. Indeed, it is working fine when my dataset has the conventional POP (t, z, y, x) dimensions. So, my speculation is it is related to the unconventional dataset dimensions, which xgcm cannot perhaps handle it?</p>



<a name="32056"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32056" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Who Kim <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32056">(May 20 2021 at 20:11)</a>:</h4>
<p>I just want to add that the operation for UET and VNT is working with the unconventional data dimentions.</p>



<a name="32058"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32058" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32058">(May 20 2021 at 20:13)</a>:</h4>
<p>would you mind copying the dimensions of your dataarrays here Who? I don't understand where the duplicate <code>nlon_u</code> is coming from.</p>



<a name="32060"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32060" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32060">(May 20 2021 at 20:14)</a>:</h4>
<p>specifically <code>VOL</code> (without <code>.values</code>) and <code>WTT</code></p>



<a name="32067"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32067" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Who Kim <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32067">(May 20 2021 at 20:18)</a>:</h4>
<p><code>'VOL' (z_t: 60, nlat_t: 384, nlon_t: 320)</code><br>
<code>'WTT' (Y: 63, M: 39, L: 122, z_w_top: 60, nlat_t: 384, nlon_t: 320)</code><br>
The error message above is what I got when I ran the operation for UET without .values, not WTT</p>



<a name="32068"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32068" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32068">(May 20 2021 at 20:19)</a>:</h4>
<blockquote>
<p>I just want to add that the operation for UET and VNT is working with the unconventional data dimentions.</p>
</blockquote>
<p>ah so you meant when you run this with .values? I misunderstood</p>



<a name="32070"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32070" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Who Kim <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32070">(May 20 2021 at 20:20)</a>:</h4>
<p>Correct</p>



<a name="32071"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32071" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32071">(May 20 2021 at 20:20)</a>:</h4>
<p>so what are the dimensions of <code>UET</code>? <code>(Y: 63, M: 39, L: 122, z_t: 60, nlat_t: 384, nlon_u: 320)</code>?</p>



<a name="32073"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32073" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Who Kim <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32073">(May 20 2021 at 20:21)</a>:</h4>
<p>Yes</p>



<a name="32075"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32075" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32075">(May 20 2021 at 20:26)</a>:</h4>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="32112"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32112" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julius Busecke <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32112">(May 20 2021 at 22:56)</a>:</h4>
<p>Hey everyone. I have to admit I am a bit overwhelmed right here (might also be the dask summit haha). What is the exact code that fails?</p>



<a name="32120"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32120" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Who Kim <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32120">(May 21 2021 at 16:51)</a>:</h4>
<p>The code fails to compute, </p>
<p><code>budget["WTT"] = (gridxgcm.diff(dsxgcm.WTT.fillna(0) * dsxgcm.VOL2.values, axis="Z")/dsxgcm.VOL)</code></p>
<p>, while the the same operation in X and Y directions is working fine. I am working with data (CESM DPLE) with "unusual" dimensions, which include additional "lead time" and "member" dimesions (ie., (lead time, member, start year, z, y, x)). The same operation is working fine when the data dimensions are the usual POP dimenions (time, z, y, x).</p>



<a name="32132"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32132" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anderson Banihirwe <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32132">(May 21 2021 at 18:06)</a>:</h4>
<p>It might be useful to have a reproducible example notebook in order to diagnose this issue. <span class="user-mention" data-user-id="51">@Who Kim</span>, is your work in a notebook that is publicly accessible or somewhere on Glade?</p>



<a name="32196"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32196" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Who Kim <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32196">(May 21 2021 at 22:23)</a>:</h4>
<p>I think I found what went wrong. When reading the data, I only stored the variables and coordinates that I though necessary, including <code>z_w_top</code>, but somehow <code>to_xgcm_grid_dataset</code> coudn't convert  <code>z_w_top</code> to xgcm dataset as a coordinate, while it did for <code>z_w_bot</code>. When I imported everying,  <code>z_w_top</code> appears as a coordinate, weird. Thank everyone responded here!</p>



<a name="32233"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/32233" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deepak Cherian <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#32233">(May 21 2021 at 23:26)</a>:</h4>
<p>hmm.. that error message is really misleading then. It should've told you that <code>z_w_top</code> was missing</p>



<a name="35408"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/35408" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#35408">(Jun 23 2021 at 17:22)</a>:</h4>
<blockquote>
<p>I think I found what went wrong. When reading the data, I only stored the variables and coordinates that I though necessary, including <code>z_w_top</code>, but somehow <code>to_xgcm_grid_dataset</code> coudn't convert  <code>z_w_top</code> to xgcm dataset as a coordinate, while it did for <code>z_w_bot</code>. When I imported everying,  <code>z_w_top</code> appears as a coordinate, weird. </p>
</blockquote>
<p>I actually  just had the same problem, would be great if someone could look into why <code>to_xgcm_grid_dataset</code> does not bring <code>z_w_top</code> along!</p>



<a name="35409"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/35409" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deepak Cherian <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#35409">(Jun 23 2021 at 17:24)</a>:</h4>
<p>open an issue!</p>



<a name="35410"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/17-python-dev/topic/pop-tools%20%3A%20tracer%20budgets/near/35410" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anna-Lena Deppenmeier <a href="http://127.0.0.1:4000/html/stream/17-python-dev/topic/pop-tools.20.3A.20tracer.20budgets.html#35410">(Jun 23 2021 at 17:25)</a>:</h4>
<p>I am currently having problems with this line </p>
<div class="codehilite"><pre><span></span><span class="n">budget</span><span class="p">[</span><span class="s2">&quot;DIA_IMPVF_TEMP&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">SRF_TEMP_FLUX</span> <span class="o">*</span> <span class="n">dsxgcm</span><span class="o">.</span><span class="n">TAREA</span> <span class="o">-</span> <span class="n">dsxgcm</span><span class="o">.</span><span class="n">DIA_IMPVF_TEMP</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">z_w_bot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">dsxgcm</span><span class="o">.</span><span class="n">TAREA</span>
<span class="p">)</span> <span class="o">/</span> <span class="n">dsxgcm</span><span class="o">.</span><span class="n">VOL</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
</pre></div>


<p>This works when I use the example script, which only has 1 timestep. In that case <code>ds.DIA_IMPVF_TEMP</code> is not a dask array. It does not work when I load multiple files, then <code>ds.DIA_IMPVF_TEMP</code> is a dask array, and I can't assign with <code>budget["DIA_IMPVF_TEMP"][:, 0, :, :] =...</code> . yesterday I tried to get around this by loading <code>ds.DIA_IMPVF_TEMP</code>, which resulted in a memory error. How can I assign something to a dask array without loading?</p>



<hr><p>Last updated: Jan 27 2025 at 22:16 UTC</p>
</html>