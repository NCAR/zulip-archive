<html>
<head><meta charset="utf-8"><title>DPLE · fisheries · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://127.0.0.1:4000/html/stream/33-fisheries/index.html">fisheries</a></h2>
<h3>Topic: <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html">DPLE</a></h3>

<hr>

<base href="https://zulip2.cloud.ucar.edu">

<head><link href="http://127.0.0.1:4000/style.css" rel="stylesheet"></head>

<a name="32989"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/32989" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#32989">(May 28 2021 at 20:28)</a>:</h4>
<p>Hello <span class="user-mention" data-user-id="122">@Colleen Petrik</span> I've found my notebook that processes DPLE and does the drift correction. I think it should still work just fine. However, I need to get the unprocessed DPLE data. Before (when I was processing a bunch of DPLE variables) I usually grabbed the data files off tape for the variables I needed (I think they were compressed tar files) and put it on my scratch space (then deleted them after I processed them). However, now I can't remember where it is on tape (and my post-it that has the path to the data on tape is hanging on my office wall at NCAR-- not too useful!) <span class="user-mention" data-user-id="14">@Matt Long</span> do you know where i can find the orginal dple output? Not sure if it would be only on tape ... or if it's located elsewhere on glade..</p>



<a name="33012"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/33012" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Levy <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#33012">(May 28 2021 at 21:00)</a>:</h4>
<p><span class="user-mention" data-user-id="28">@Kristen Krumhardt</span> -- there's a DPLE directory on campaign: <code>/glade/campaign/cesm/collections/CESM1-DPLE</code> I don't know much about the experiment, so no idea how complete the data set is... it could be the case that Gary is still moving data from HPSS over</p>



<a name="33016"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/33016" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#33016">(May 28 2021 at 21:05)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="10">@Michael Levy</span> !! I think that directory should have all the data we need (and the files are already in netcdf rather than tar - yay! one less step:))</p>



<a name="33049"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/33049" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#33049">(May 29 2021 at 13:24)</a>:</h4>
<p>DPLE data is here</p>
<div class="codehilite"><pre><span></span>/glade/campaign/cesm/collections/CESM1-DPLE
</pre></div>


<p><span class="user-mention" data-user-id="34">@Stephen Yeager</span> or <span class="user-mention" data-user-id="63">@Elizabeth Maroon</span> have you advanced the state-of-the-art in DPLE processing/drift correction? Could you point <span class="user-mention" data-user-id="122">@Colleen Petrik</span> and <span class="user-mention" data-user-id="28">@Kristen Krumhardt</span> to a latest example code? We're spinning up to assess predictability of fishes.</p>



<a name="33050"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/33050" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#33050">(May 29 2021 at 13:45)</a>:</h4>
<p>The notebooks I have come from <span class="user-mention" data-user-id="63">@Elizabeth Maroon</span> .</p>



<a name="33052"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/33052" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elizabeth Maroon <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#33052">(May 29 2021 at 18:23)</a>:</h4>
<p>The notebooks that <span class="user-mention" data-user-id="28">@Kristen Krumhardt</span> has are pretty old, and while they do get the job done, Steve, Who, and I have been iterating on a cleaner/better notebook over the past few months. Adding a drift correction function to them is currently on my desk. I'll put that on the short list of things to get done next week and get back to you soon.  </p>
<p>For now, you can find the current example notebook that does everything <em>except</em> drift correction here: <a href="https://github.com/NCAR/RAPCDI-analysis/blob/main/notebooks/DPLE_ENSO_check.ipynb" target="_blank" title="https://github.com/NCAR/RAPCDI-analysis/blob/main/notebooks/DPLE_ENSO_check.ipynb">https://github.com/NCAR/RAPCDI-analysis/blob/main/notebooks/DPLE_ENSO_check.ipynb</a></p>



<a name="33053"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/33053" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#33053">(May 29 2021 at 20:28)</a>:</h4>
<p>Thanks!</p>



<a name="35060"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/35060" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#35060">(Jun 21 2021 at 16:36)</a>:</h4>
<p>Hello, just wanted to provide an update here. I used <span class="user-mention" data-user-id="63">@Elizabeth Maroon</span> 's new notebook for processing the DPLE and was able to get some of the necessary variables for FEISTY processed. Right now I'm just trying to process 2 year (24 month) forecasts from 1970 to 2018 (just as a starting point).  I've combined Liz's notebook (with her new drift correction) with some functions from the <code>proc-cesm-dple-fields.ipynb</code> notebook from the fish-offline repo. I successfully processed 150m mean temp, and depth integrated spC, diatC, zooC, and zoo loss variables. the output is here: <code>/glade/work/kristenk/fish-offline/</code> . However, I'm having trouble with making the bottom field variables for TEMP and POC_FLUX_IN. My notebook is here and you can see the error I'm getting concerning the <code>field_at_bottom</code> function when I try to make a quick map of the anomalies (I get the same error when trying to load the dso_anoms before writing out the netcdf): <code>https://github.com/kristenkrumhardt/fish-offline/blob/kristens_branch/notebooks/DPLE_process_FEISTY_fields.ipynb</code></p>
<p>I worked with <span class="user-mention" data-user-id="10">@Michael Levy</span> briefly on friday to try to find a solution (our attempts are in a copy of the above notebook, not yet in my branch of the fish-offline repo), but we weren't able to fix it yet...</p>
<p><span class="user-mention" data-user-id="14">@Matt Long</span> do you have any suggestions on how to proceed?</p>



<a name="36414"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/36414" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#36414">(Jul 06 2021 at 14:45)</a>:</h4>
<p>Hello! I am finally through processing the DPLE variables necessary for FEISTY. You'll find monthly drift-corrected anomalies for 150m integrated spC, diatC, zooC,  and zoo_loss, 150m mean TEMP, and bottom fields for TEMP and  POC_FLUX_IN here:</p>
<p><code>/glade/scratch/kristenk/fish-offline</code></p>
<p>I did all forecast start years (1954-2017), 10 year (122 month) forecasts. <span class="user-mention" data-user-id="122">@Colleen Petrik</span>  let me know if you have questions! Thanks :)</p>



<a name="37398"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/37398" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#37398">(Jul 14 2021 at 21:46)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="28">@Kristen Krumhardt</span> ! Does this DPLPE use a different gridspec than the FOSI with <code>grid-data-POP_gx1v6.nc</code>? I don't think it does, but I'm trying to understand why the variables seem to have a different number of non-nan grid cells from that and from each other. Do you know why only pelagic temperature agrees?<br>
For example,<br>
bottom temp      86199                         <br>
bottom POC        86199                          <br>
diatC                      85813                      <br>
pelagic temp      86212                   <br>
zooC                       85813<br>
zoo loss                 85813                          <br>
POP                        86212</p>



<a name="37417"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/37417" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#37417">(Jul 14 2021 at 22:08)</a>:</h4>
<p>hmmm that is a good question! I will look into it and let you know:)</p>



<a name="37445"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/37445" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#37445">(Jul 15 2021 at 12:58)</a>:</h4>
<p>The DPLE and FOSI use the same grid. What do you mean by</p>
<blockquote>
<p>Do you know why only pelagic temperature agrees?</p>
</blockquote>
<p>Also, what is that list of numbers?</p>
<p>Do you see differences in the NaNs if you manually mask our land? You can do this as follows:</p>
<div class="codehilite"><pre><span></span><span class="n">field_masked</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">KMT</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>


<p>for example.</p>



<a name="37794"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/37794" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#37794">(Jul 16 2021 at 23:07)</a>:</h4>
<p>I used the region_mask in the POP grid data file to create the land_mask, but I just tested your method using KMT instead. Both of those methods give 86212 ocean cells. I like to verify that all of these grid cells contain non-nan (or non-FillValue) values for each forcing variable otherwise it doesn't make sense to run FEISTY in those cells.</p>
<p>All the numbers I listed are the number of non-nan grid cells for that variable for a given time. For example, </p>
<div class="codehilite"><pre><span></span>sum( find( ~isnan( diatC(:,:,1) ) ) ) = 85813
</pre></div>


<p>Which means that there are some ocean cells of the DPLE files missing variables even though they aren't land. This was not the case for the FOSI run where all the forcing variables listed had 86212 non-nan cells, the same number as the land-masked cells.</p>



<a name="38316"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/38316" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#38316">(Jul 22 2021 at 19:20)</a>:</h4>
<p><span class="user-mention" data-user-id="122">@Colleen Petrik</span>, here's a path to the CESM-LENS tag code base:<br>
/glade/p/cgd/oce/people/mclong/cesm/cesm1_1_2_LENS_n19/models/ocn/pop2/source</p>



<a name="38317"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/38317" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#38317">(Jul 22 2021 at 19:21)</a>:</h4>
<p>Here is the equation for <code>zoo_loss</code></p>
<div class="codehilite"><pre><span></span><span class="n">zoo_loss</span> <span class="o">=</span> <span class="n">z_mort2</span> <span class="o">*</span> <span class="n">Zprime</span><span class="o">**</span><span class="mf">1.4_r8</span> <span class="o">+</span> <span class="n">z_mort</span> <span class="o">*</span> <span class="n">Zprime</span>
</pre></div>



<a name="38323"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/38323" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#38323">(Jul 22 2021 at 19:28)</a>:</h4>
<div class="codehilite"><pre><span></span>   <span class="n">thres_z1</span>          <span class="o">=</span> <span class="mi">10</span><span class="mf">0.0e2_r8</span>
   <span class="n">thres_z2</span>          <span class="o">=</span> <span class="mi">20</span><span class="mf">0.0e2_r8</span>
   <span class="n">loss_thres_zoo</span>    <span class="o">=</span> <span class="mf">0.2_r8</span>

  <span class="n">parm_z_mort_0</span>  <span class="o">=</span> <span class="mf">0.08_r8</span> <span class="o">*</span> <span class="n">dps</span>
  <span class="n">parm_z_mort2_0</span>  <span class="o">=</span> <span class="mf">0.42_r8</span> <span class="o">*</span> <span class="n">dps</span>

   <span class="n">z_mort2</span>   <span class="o">=</span> <span class="n">parm_z_mort2_0</span>   <span class="o">*</span> <span class="n">Tfunc</span>
   <span class="n">z_mort</span>    <span class="o">=</span> <span class="n">parm_z_mort_0</span>    <span class="o">*</span> <span class="n">Tfunc</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">zt</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">thres_z1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">      if</span> <span class="p">(</span><span class="n">zt</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">thres_z2</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         </span><span class="n">f_loss_thres</span> <span class="o">=</span> <span class="p">(</span><span class="n">thres_z2</span> <span class="o">-</span> <span class="n">zt</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">thres_z2</span> <span class="o">-</span> <span class="n">thres_z1</span><span class="p">)</span>
      <span class="k">else</span>
<span class="k">         </span><span class="n">f_loss_thres</span> <span class="o">=</span> <span class="n">c0</span>
      <span class="n">endif</span>
   <span class="k">else</span>
<span class="k">      </span><span class="n">f_loss_thres</span> <span class="o">=</span> <span class="n">c1</span>
   <span class="n">endif</span>

   <span class="n">C_loss_thres</span> <span class="o">=</span> <span class="n">f_loss_thres</span> <span class="o">*</span> <span class="n">loss_thres_zoo</span>
   <span class="n">Zprime</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">zooC_loc</span> <span class="o">-</span> <span class="n">C_loss_thres</span><span class="p">,</span> <span class="n">c0</span><span class="p">)</span>

  <span class="n">zoo_loss</span> <span class="o">=</span> <span class="n">z_mort2</span> <span class="o">*</span> <span class="n">Zprime</span><span class="o">**</span><span class="mf">1.4_r8</span> <span class="o">+</span> <span class="n">z_mort</span> <span class="o">*</span> <span class="n">Zprime</span>
</pre></div>



<a name="38348"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/38348" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#38348">(Jul 22 2021 at 21:38)</a>:</h4>
<p>More on the discrepancies in the number of non-NaN grid cells in the DPLE. The integrated variables (diatC, spC, zooC, zoo_loss) have extra NaNs in the Baltic, Black, Caspian, and Red Seas. However, the bottom variables (TEMP_bottom and POC_flux) have extra NaNs in 13 distinct locations:<br>
    Lat       Lon  <br>
    _______    ______<br>
    -76.015    182.19<br>
    -76.015    183.31<br>
    -76.015    184.44<br>
    -74.947    325.06<br>
    -74.947    326.19<br>
    -74.947    327.31<br>
    -74.947    328.44<br>
     60.869    355.98<br>
     61.279    355.73<br>
     61.688    355.46<br>
     67.058    334.03<br>
     67.455    333.73<br>
     67.854    333.41</p>



<a name="38524"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/38524" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#38524">(Jul 23 2021 at 18:54)</a>:</h4>
<p>Ok, so we should be ignoring "marginal seas," which are designated by negative values in the <code>REGION_MASK</code> variable.</p>
<p>The points you note as different are likely "src" locations for the "overflow" parameterization, which "pops" up <code>KMT</code>. The <code>pop_tools.get_grid</code> method does not have these "pop up" locations, so where we use <code>KMT</code> from that tool, we're probably indexing <code>KMT + 1</code> and getting a NaN. </p>
<p><span class="user-mention" data-user-id="28">@Kristen Krumhardt</span>, can you work with <span class="user-mention" data-user-id="122">@Colleen Petrik</span> to get these discrepancies reconciled?</p>



<a name="38526"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/38526" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#38526">(Jul 23 2021 at 18:57)</a>:</h4>
<p>Ideally, we would add code to <code>pop_tools.get_grid</code> that reads the overflow input file <a href="https://github.com/ESCOMP/POP2-CESM/blob/master/input_templates/gx1v6_overflow" target="_blank" title="https://github.com/ESCOMP/POP2-CESM/blob/master/input_templates/gx1v6_overflow">here</a> and applies the <code>KMT</code> modifications.</p>



<a name="38826"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/38826" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#38826">(Aug 02 2021 at 22:33)</a>:</h4>
<p>The DPLE outputs Kristen kindly post-processed are drift-corrected anomalies. Can I get actual values for forcing FEISTY by adding these anomalies to the appropriate FOSI year and month?</p>



<a name="38847"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/38847" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#38847">(Aug 03 2021 at 15:27)</a>:</h4>
<p><span class="user-mention" data-user-id="122">@Colleen Petrik</span>, I think there is an order of operations question here and I apologize for not catching this sooner. It seems to me that the most appropriate approach would be to compute the fish on the DPLE output—and then apply the drift correction procedure to generate forcast anomalies in the fish.</p>



<a name="38848"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/38848" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#38848">(Aug 03 2021 at 15:44)</a>:</h4>
<p>I can easily generate non-drift corrected DPLE output for the variables needed for FEISTY. Then we can do the drift correction on the FEISTY output later on.. <span class="user-mention" data-user-id="122">@Colleen Petrik</span> , I'll let you know when I've got these files ready for you:)</p>



<a name="38928"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/38928" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#38928">(Aug 04 2021 at 01:54)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="28">@Kristen Krumhardt</span>  and <span class="user-mention" data-user-id="14">@Matt Long</span> .</p>



<a name="39229"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/39229" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#39229">(Aug 05 2021 at 20:21)</a>:</h4>
<p>Welcome <span class="user-mention" data-user-id="185">@Zhuomin Chen</span> to Zulip!</p>
<p><span class="user-mention" data-user-id="185">@Zhuomin Chen</span> just started as a researcher at UCONN and will be analyzing the DPLE</p>



<a name="39239"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/39239" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zhuomin Chen <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#39239">(Aug 05 2021 at 21:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="14">Matt Long</span> <a href="#narrow/stream/33-fisheries/topic/DPLE/near/39229">said</a>:</p>
<blockquote>
<p>Welcome <span class="user-mention silent" data-user-id="185">Zhuomin Chen</span> to Zulip!</p>
<p><span class="user-mention silent" data-user-id="185">Zhuomin Chen</span> just started as a researcher at UCONN and will be analyzing the DPLE</p>
</blockquote>
<p>Thank you Matt! I am new to Zulip, and very happy to join this forum!</p>



<a name="39244"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/39244" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#39244">(Aug 06 2021 at 00:57)</a>:</h4>
<p><span class="user-mention" data-user-id="14">@Matt Long</span> , I couldn't find 3 parameters in the ecosys code: c0 (zero?), c1 (one?), and T0_Kelvin (273.15?). Just want to be sure before moving forward on the quadratic mortality back calculation.</p>



<a name="39250"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/39250" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#39250">(Aug 06 2021 at 15:01)</a>:</h4>
<p>you got it, except for some reason, POP uses T0_Kelvin = 273.16, as you can see <a href="https://github.com/ESCOMP/POP2-CESM/blob/177be5849c3ccd75266ac5b4798d5b1b54849e4c/source/constants.F90#L234">here</a>. The other constants are defined in that module too.</p>



<a name="39677"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/39677" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#39677">(Aug 12 2021 at 17:59)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="122">@Colleen Petrik</span> ! I prepared the non-drift corrected FEISTY variables. They are here: <code>/glade/scratch/kristenk/fish-offline/*_nodriftcorr.nc</code></p>



<a name="39741"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/39741" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#39741">(Aug 13 2021 at 01:07)</a>:</h4>
<p>Excellent, thanks <span class="user-mention" data-user-id="28">@Kristen Krumhardt</span> ! I'll start working with these. Could you also help me process additional FOSI outputs? I tried to modify the <code>proc-cesm-dple-fields.ipynb</code> code to include all 3 phytoplankton production individual outputs (integrated over top 150m), but I'm having troubling starting a dask cluster.</p>



<a name="39765"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/39765" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#39765">(Aug 13 2021 at 16:04)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="122">@Colleen Petrik</span> , I can definitely help with this. So, just to clarify, do you need the photoC_sp, photoC_diat, and photoC_diaz terms depth integrated from the FOSI? these are net primary production from each phytoplankton functional type. I ran my version of <code>proc_cesm-dple-fields.ipynb</code>  (with an updated dask part) on those three variables. Output is here: <code>/glade/work/kristenk/fish-offline/g.e11_LENS.GECOIAF.T62_g16.009.phytoNPP_FIESTY-forcing.nc</code></p>



<a name="39771"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/39771" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#39771">(Aug 13 2021 at 17:30)</a>:</h4>
<p>Thanks, you're the best! I'm going to test if phyto production rather than phyto biomass is a better way to split the zoo into small and large. I'll let you know how it goes.</p>



<a name="40224"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/40224" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#40224">(Aug 19 2021 at 21:07)</a>:</h4>
<p><span class="user-mention" data-user-id="28">@Kristen Krumhardt</span>, Can you help get <span class="user-mention" data-user-id="185">@Zhuomin Chen</span> pointed in the right direction working with the DPLE output? She is ramping up on an analysis looking at predictability of O2, pO2, and T. In particular, it would be helpful to point her to (and perhaps walk her thru) the drift correction/analysis codes you have.</p>
<p>cc <span class="user-mention" data-user-id="34">@Stephen Yeager</span>, <span class="user-mention" data-user-id="63">@Elizabeth Maroon</span>, <span class="user-mention" data-user-id="124">@Samantha Siedlecki</span></p>



<a name="40225"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/40225" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#40225">(Aug 19 2021 at 21:25)</a>:</h4>
<p>Sure, <span class="user-mention" data-user-id="14">@Matt Long</span> ! Hi <span class="user-mention" data-user-id="185">@Zhuomin Chen</span> ! I'd be delighted to help you out. I have a few notebooks that have been working nicely for me here: <code>/glade/u/home/kristenk/fish-offline/notebooks</code> .. sometimes it helps to preprocess data into a 2-D variable before doing the drift correction. I think it might be best to set up a meeting so I can walk you through these notebooks. I'll send you a PM to set up a time to meet.</p>



<a name="40226"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/40226" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#40226">(Aug 19 2021 at 21:27)</a>:</h4>
<p>@Stephen Yeager, @Elizabeth Maroon, please weigh in if you have important updates...or possibly this is an opportunity to expand your circle of potential developers.</p>



<a name="41642"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/41642" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#41642">(Sep 01 2021 at 22:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="28">Kristen Krumhardt</span> <a href="#narrow/stream/33-fisheries/topic/DPLE/near/39765">said</a>:</p>
<blockquote>
<p>... just to clarify, do you need the photoC_sp, photoC_diat, and photoC_diaz terms depth integrated from the FOSI? these are net primary production from each phytoplankton functional type. I ran my version of <code>proc_cesm-dple-fields.ipynb</code>  (with an updated dask part) on those three variables...</p>
</blockquote>
<p>Using all 3 phytoplankton types seemed to help with splitting the zooplankton into mesozooplankton, leading to better regional variability (oligotrophic vs. eutrophic areas) of the fish biomass. Could you please run your version of <code>proc_cesm-dple-fields.ipynb</code> to get the integrated diazC fields from the FOSI? I'm trying a few more parameter tests, but we may need to include this output with the full DPLE.</p>



<a name="41644"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/41644" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#41644">(Sep 01 2021 at 22:48)</a>:</h4>
<p><span class="user-mention" data-user-id="28">@Kristen Krumhardt</span> , didn't realize that the above wouldn't ping you.</p>



<a name="41656"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/41656" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#41656">(Sep 02 2021 at 13:19)</a>:</h4>
<p><span class="user-mention" data-user-id="122">@Colleen Petrik</span> Sure, I'll do the diazC FOSI processing today and let you know when it's done. </p>
<p>Also, no problem to process diazC for the DPLE, just let me know:)</p>



<a name="41758"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/41758" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#41758">(Sep 02 2021 at 18:05)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="122">@Colleen Petrik</span> , the FOSI diazC file is here:<br>
<code>/glade/work/kristenk/fish-offline/g.e11_LENS.GECOIAF.T62_g16.009.diazC_FIESTY-forcing.nc</code></p>



<a name="41761"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/41761" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#41761">(Sep 02 2021 at 18:43)</a>:</h4>
<p>Thanks, <span class="user-mention" data-user-id="28">@Kristen Krumhardt</span> ! And I finally was able to run one of your notebooks, so hopefully I won't have to ask for such minor requests in the future.</p>



<a name="45428"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/45428" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#45428">(Oct 20 2021 at 22:35)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="28">@Kristen Krumhardt</span>. The biomass of all 3 phytoplankton was better than just diat and small. Could you please update and reprocess the DPLE notebook to create the FEISTY outputs with all 3 phytoC variables? Thanks!</p>



<a name="45429"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/45429" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#45429">(Oct 20 2021 at 22:45)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="122">@Colleen Petrik</span> ! So you just need DPLE diazC integrated from 150m, right? no drift correction, right?</p>



<a name="45461"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/45461" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#45461">(Oct 21 2021 at 17:00)</a>:</h4>
<p>Yes, I need the diazC 150m integration in regular biomass units in addition to zooC, zoo_loss, diatC, spC, etc., non-drift corrected.</p>



<a name="45475"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/45475" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#45475">(Oct 21 2021 at 18:43)</a>:</h4>
<p>Ok, I'll let you know when I'm done processing this (probably tomorrow)</p>



<a name="45548"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/45548" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#45548">(Oct 22 2021 at 18:04)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="122">@Colleen Petrik</span> , I just finished processing DPLE depth integrated diazC (no drift correction). All output is here: <code>/glade/scratch/kristenk/fish-offline</code>. please let me know if there's anything missing</p>



<a name="47588"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/47588" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#47588">(Dec 02 2021 at 00:04)</a>:</h4>
<p>Thanks, <span class="user-mention" data-user-id="28">@Kristen Krumhardt</span> ! Looks good so far.</p>



<a name="49424"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/49424" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#49424">(Jan 19 2022 at 21:23)</a>:</h4>
<p><span class="user-mention" data-user-id="28">@Kristen Krumhardt</span> , after discussing order of operations again with Matt and Charlie, we decided to use the drift-corrected anomalies (added to the climatology to get fish relevant values) to force FEISTY. Would you mind processing these again? I need the 150m mean of temp, bottom temp, bottom POC, and the 150m integration of zooC, zoo_loss, diatC, spC, diazC. The diazC might not have been in your notebook the last time you did this.</p>



<a name="49425"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/49425" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#49425">(Jan 19 2022 at 21:27)</a>:</h4>
<p>Hi Colleen! Sure I will start on this shortly. If I remember correctly, there are two steps to make these drift-corrected anomalies, so it may take a bit of time. I will also add diazC to my workflow. Will be in touch when I have an idea on when this will all be ready :) (hopefully within the next week or so)</p>



<a name="49550"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/49550" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#49550">(Jan 21 2022 at 20:30)</a>:</h4>
<p><span class="user-mention" data-user-id="28">@Kristen Krumhardt</span> , thank you!</p>



<a name="49707"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/49707" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#49707">(Jan 26 2022 at 14:21)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="122">@Colleen Petrik</span>! Drift-corrected anomalies for forcing FEISTY are ready. They are here: <code>/glade/scratch/kristenk/fish-offline/</code> .</p>



<a name="51363"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/51363" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#51363">(Mar 02 2022 at 23:10)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="28">@Kristen Krumhardt</span> , maybe I took too long to work with these files, but it seems that TEMP_bottom and diazC_150m files are missing.</p>
<p>Also, does your drift correction notebook have a good example of how to match up the DPLE ensemble member with the equivalent time in the FOSI? Thanks!</p>



<a name="51378"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/51378" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#51378">(Mar 03 2022 at 00:17)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="122">@Colleen Petrik</span> , are you looking here for the DPLE files?: <code>/glade/scratch/kristenk/fish-offline</code></p>
<p>I think all the files are there... I actually haven't done any time alignment of the DPLE and FOSI in any of my notebooks but I think I might be able to find you an example from the SMYLE repo.. I'll take a look soon and let you know :)</p>



<a name="51379"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/51379" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#51379">(Mar 03 2022 at 00:19)</a>:</h4>
<p>I was looking at your home folder <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span> <br>
They are all in scratch.</p>



<a name="51470"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/51470" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kristen Krumhardt <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#51470">(Mar 04 2022 at 16:33)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="122">@Colleen Petrik</span> , glad you found the files :) I tried to find an example for lining up the FOSI with DPLE ensemble members in the SMYLE repo.. so I haven't found precisely that but there's an example of lining up ERA5 sea level pressure observational data with the DPLE ensemble mean in this notebook (it's not my notebook, but it's in the SMYLE repo so I have a copy of it in my directory): <code>/glade/u/home/kristenk/SMYLE-analysis/notebooks/PaperFigsSMYLEvsDPLE_GlobMaps_SLP.ipynb</code></p>
<p>Look at cells 22 and 23. There's a function called <code>leadtime_corr_byseas </code> that uses the xarray align function. that notebook uses seasonal averages rather than monthly, though. Not sure if that's helpful...</p>



<a name="51488"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/51488" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#51488">(Mar 04 2022 at 18:35)</a>:</h4>
<p>Thanks, <span class="user-mention" data-user-id="28">@Kristen Krumhardt</span> , I'll look into the function in this notebook. <span class="user-mention" data-user-id="14">@Matt Long</span> , do you have any other suggestions for aligning the DPLE ensemble members with the equivalent time in the FOSI?</p>



<a name="51491"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/51491" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#51491">(Mar 04 2022 at 18:44)</a>:</h4>
<p>I think it's mainly a question of careful indexing. unfortunately, I don't think I have a clear example to point you to.</p>



<a name="52273"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/52273" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Levy <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#52273">(Mar 16 2022 at 17:23)</a>:</h4>
<p><span class="user-mention" data-user-id="122">@Colleen Petrik</span> Like we talked about yesterday, I'm going to do one more set of "matlab vs python" comparisons using <code>FOSI_cesm.m</code>; I used <code>daily_interp_cesm_fosi_totmort_extend_LfracB_allphytos.m</code> to generate 68 <code>Data_cesm_fosi_v6_daily_NN.mat</code> files (<code>NN</code> in <code>01</code> -&gt; <code>68</code>). I also found <code>Data_grid_POP_gx1v6_noSeas.mat</code> (I think I copied it out of your directory on cheyenne); the last thing I'm missing is the initialization file. The <code>.m</code> file is trying to run</p>
<div class="codehilite" data-code-language="Matlab"><pre><span></span><code><span class="nb">load</span><span class="p">([</span><span class="s">'/Volumes/MIP/NC/CESM_MAPP/'</span><span class="p">,</span><span class="n">simname</span><span class="w"> </span><span class="s">'/Last_mo_spin_'</span><span class="w"> </span><span class="n">init_sim</span><span class="w"> </span><span class="s">'.mat'</span><span class="p">]);</span><span class="w"></span>
</code></pre></div>
<p>I changed all the <code>/Volumes/MIP/NC</code> paths to <code>input_data</code> in  <code>FOSI_cesm.m</code> and <code>sub_fname_cesm_fosi_exper.m</code>, but the former is now giving me an error because it can't find the file <code>Dc_Lam700_enc70-b200_m400-b175-k086_c20-b250_D075_A050_sMZ090_mMZ045_nmort1_BE08_CC80_RE00100/Last_mo_spin_v14_Dc_Lam700_enc70-b200_m400-b175-k086_c20-b250_D075_A050_sMZ090_mMZ045_nmort1_BE08_CC80_RE00100.mat</code>. Do you have this on your laptop? Could you either copy it to cheyenne or let me know how to generate it?</p>
<p>Thanks!</p>



<a name="52466"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/52466" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#52466">(Mar 21 2022 at 22:37)</a>:</h4>
<p><span class="user-mention" data-user-id="10">@Michael Levy</span> , I totally meant to upload this on Tuesday before going out of town. I uploaded the initialization file to the <code>input_data</code> folder. I also added an example of the daily forcing files <code>Data_cesm_fosi_daily_1.mat</code>. I will take a look at the daily files you created.</p>



<a name="52467"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/52467" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#52467">(Mar 21 2022 at 22:44)</a>:</h4>
<p>Where can I find the <code>daily_interp_cesm_fosi_totmort_extend_LfracB_allphytos.m</code> file?</p>



<a name="52468"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/52468" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Levy <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#52468">(Mar 21 2022 at 22:59)</a>:</h4>
<p><span class="user-mention" data-user-id="122">@Colleen Petrik</span> <code>/glade/work/mlevy/codes/fish-offline/MatFEISTY/cesm_mfiles/daily_interp_cesm_fosi_totmort_extend_LfracB_allphytos.m</code></p>



<a name="52618"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/52618" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Levy <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#52618">(Mar 23 2022 at 19:58)</a>:</h4>
<p><span class="user-mention" data-user-id="122">@Colleen Petrik</span> I'm seeing differences between matlab's FOSI results and python's FOSI results, which I think might be due to different parameterizations. The differences between the two setups are as follows (<code>&lt;</code> is testcase, <code>&gt;</code> is FOSI):</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code>62c62
&lt;     param.CC = 0; % 80
<span class="gd">---</span>
&gt;     param.CC = 80; % 80
91,94d85
&lt;
&lt;     param.D  = 0.75;   %Demersal feeding in pelagic reduction
&lt;     param.A  = 0.5;    %Adult predation reduction %*****
&lt;     param.MZ = 1.0;    %Preference on one mesozooplankton group
96,97c87,91
&lt;     param.MF_phi_MZ = 0.45 * param.MZ;
&lt;     param.MF_phi_LZ = 1.0;
<span class="gd">---</span>
&gt;     param.D  = 0.75;  %Demersal feeding in pelagic reduction
&gt;     param.A  = 0.5;   %Adult predation reduction %*****
&gt;     param.MZ = 0.9;   %Preference on one mesozooplankton group
&gt;
&gt;     param.MF_phi_MZ = 0.5 * param.MZ;
100,101c94
&lt;     param.MP_phi_MZ = 0.45 * param.MZ;
&lt;     param.MP_phi_LZ = 1.0;
<span class="gd">---</span>
&gt;     param.MP_phi_MZ = 0.5 * param.MZ;
</code></pre></div>
<p>I was able to change the carrying capacity, but I'm not sure what to make of the rest.</p>
<ol>
<li>What are the values of  <code>param.MF_phi_LZ</code> and <code>param.MP_phi_LZ</code> if they aren't specified in this file?</li>
<li>Is <code>param.MZ = 1.0; </code> used directly? Because it looks like <code>param.MF_phi_MZ</code> and <code>param.MP_phi_MZ</code> are unchanged (<code>0.5*0.9 == 0.45*1.0</code>), but maybe other values need to change from 1 -&gt; 0.9?</li>
</ol>



<a name="52619"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/52619" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Levy <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#52619">(Mar 23 2022 at 20:19)</a>:</h4>
<p>Actually, I think I figured it out -- <code>param.MF_phi_LZ</code> and <code>param.MP_phi_LZ</code> are used in <code>sub_futbio.m</code> but not <code>sub_futbio_1meso.m</code> so we don't need it, and <code>param.MZ</code> is the preference rate of <code>Sf</code>, <code>Sp</code>, and <code>Sd</code> for <code>zoo</code>. That might not  be the cleanest definition, but it's changing <code>preference</code> from <code>1.</code> to <code>0.9</code> below (I added the comment as a helpful reminder ):</p>
<div class="codehilite" data-code-language="YAML"><pre><span></span><code><span class="nt">food_web</span><span class="p">:</span>
  <span class="c1"># small forage</span>
  <span class="p p-Indicator">-</span> <span class="nt">predator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Sf</span>
    <span class="nt">prey</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Zoo</span>
    <span class="nt">preference</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.</span> <span class="c1"># [params.MZ]</span>

  <span class="c1"># small piscivore</span>
  <span class="p p-Indicator">-</span> <span class="nt">predator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Sp</span>
    <span class="nt">prey</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Zoo</span>
    <span class="nt">preference</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.</span> <span class="c1"># [params.MZ]</span>

  <span class="c1"># small demersal</span>
  <span class="p p-Indicator">-</span> <span class="nt">predator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Sd</span>
    <span class="nt">prey</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Zoo</span>
    <span class="nt">preference</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.</span> <span class="c1"># [params.MZ]</span>
</code></pre></div>



<a name="52620"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/52620" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Levy <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#52620">(Mar 23 2022 at 20:41)</a>:</h4>
<p>Differences between matlab and python results in a 10-day FOSI-forced run:</p>
<table>
<thead>
<tr>
<th>group</th>
<th>Matlab Value</th>
<th>Python Value</th>
<th>Rel Err</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sf (t=6, X=39888)</td>
<td>1.4075e-02</td>
<td>1.4075e-02</td>
<td>1.0128e-12</td>
</tr>
<tr>
<td>Sp (t=6, X=39888)</td>
<td>1.1563e-04</td>
<td>1.1563e-04</td>
<td>1.0116e-12</td>
</tr>
<tr>
<td>Sd (t=5, X=66815)</td>
<td>7.0344e-05</td>
<td>7.0344e-05</td>
<td>4.3271e-13</td>
</tr>
<tr>
<td>Mf (t=0, X=56619)</td>
<td>1.3451e-314</td>
<td>1.3451e-314</td>
<td>3.6730e-10</td>
</tr>
<tr>
<td>Mp (t=7, X=56619)</td>
<td>1.4058e-314</td>
<td>1.4058e-314</td>
<td>7.0289e-10</td>
</tr>
<tr>
<td>Md (t=9, X=50253)</td>
<td>1.7869e-01</td>
<td>1.7869e-01</td>
<td>1.3669e-14</td>
</tr>
<tr>
<td>Lp (t=2, X=43345)</td>
<td>1.8280e-322</td>
<td>1.6798e-322</td>
<td>8.1081e-02</td>
</tr>
<tr>
<td>Ld (t=9, X=50253)</td>
<td>1.3507e+00</td>
<td>1.3507e+00</td>
<td>1.8083e-15</td>
</tr>
<tr>
<td>benthic_prey (t=9, X=72149)</td>
<td>5.5872e-01</td>
<td>5.5872e-01</td>
<td>1.3910e-15</td>
</tr>
</tbody>
</table>
<p>filtering out values &lt; 1e-300, things look promising:</p>
<table>
<thead>
<tr>
<th>group</th>
<th>Matlab Value</th>
<th>Python Value</th>
<th>Rel Err</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sf (t=6, X=39888)</td>
<td>1.4075e-02</td>
<td>1.4075e-02</td>
<td>1.0128e-12</td>
</tr>
<tr>
<td>Sp (t=6, X=39888)</td>
<td>1.1563e-04</td>
<td>1.1563e-04</td>
<td>1.0116e-12</td>
</tr>
<tr>
<td>Sd (t=5, X=66815)</td>
<td>7.0344e-05</td>
<td>7.0344e-05</td>
<td>4.3271e-13</td>
</tr>
<tr>
<td>Mf (t=9, X=68694)</td>
<td>2.5383e+00</td>
<td>2.5383e+00</td>
<td>7.3482e-15</td>
</tr>
<tr>
<td>Mp (t=4, X=76742)</td>
<td>1.2744e-20</td>
<td>1.2744e-20</td>
<td>2.6092e-14</td>
</tr>
<tr>
<td>Md (t=9, X=50253)</td>
<td>1.7869e-01</td>
<td>1.7869e-01</td>
<td>1.3669e-14</td>
</tr>
<tr>
<td>Lp (t=9, X=41142)</td>
<td>3.0484e-31</td>
<td>3.0484e-31</td>
<td>2.1820e-13</td>
</tr>
<tr>
<td>Ld (t=9, X=50253)</td>
<td>1.3507e+00</td>
<td>1.3507e+00</td>
<td>1.8083e-15</td>
</tr>
<tr>
<td>benthic_prey (t=9, X=72149)</td>
<td>5.5872e-01</td>
<td>5.5872e-01</td>
<td>1.3910e-15</td>
</tr>
</tbody>
</table>
<p>performance is an issue, though. Running the matlab code for a year takes about 90s, while the python is in the neighborhood of 20s / day (more than 2 hours / year). That's a factor of 80 slower, and I thought we had gotten closer to 50x but even that would be 75 minutes per year...</p>



<a name="52636"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/52636" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#52636">(Mar 23 2022 at 21:38)</a>:</h4>
<p>You should be using <code>sub_futbio_1meso.m</code> not <code>sub_futbio.m</code> because we only have one zooplankton group from CESM. <br>
<a href="/user_uploads/2/f6/7M4tCzFnFimFeVb5Q9s0Zw55/Screen-Shot-2022-03-23-at-2.33.42-PM.png">Screen-Shot-2022-03-23-at-2.33.42-PM.png</a><br>
The correct prey preferences are (ones we eventually want to use for global runs):<br>
param.CC = 80<br>
param.D  = 0.75;   %Demersal feeding in pelagic reduction<br>
param.A  = 0.5;      %Adult predation reduction <br>
param.MZ = 0.9;    %Preference on one mesozooplankton group<br>
param.MF_phi_MZ = 0.5 * param.MZ;<br>
param.MP_phi_MZ = 0.5 * param.MZ;</p>
<div class="message_inline_image"><a href="/user_uploads/2/f6/7M4tCzFnFimFeVb5Q9s0Zw55/Screen-Shot-2022-03-23-at-2.33.42-PM.png" title="Screen-Shot-2022-03-23-at-2.33.42-PM.png"><img src="/user_uploads/2/f6/7M4tCzFnFimFeVb5Q9s0Zw55/Screen-Shot-2022-03-23-at-2.33.42-PM.png"></a></div>



<a name="52637"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/52637" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Levy <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#52637">(Mar 24 2022 at 01:50)</a>:</h4>
<p>Okay, I ran for a full year and it wasn't quite as slow as I feared (but was still really slow): 93 minutes (so a little over 60x slower than the matlab code). Results looked okay, though:</p>
<table>
<thead>
<tr>
<th>biomass</th>
<th>Matlab Value</th>
<th>Python Value</th>
<th>Rel Err</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sf (t=258, X=60616)</td>
<td>1.5367e-02</td>
<td>1.5367e-02</td>
<td>2.9886e-11</td>
</tr>
<tr>
<td>Sp (t=138, X=799)</td>
<td>3.0873e-26</td>
<td>3.0873e-26</td>
<td>1.4703e-10</td>
</tr>
<tr>
<td>Sd (t=258, X=60616)</td>
<td>3.2256e-05</td>
<td>3.2256e-05</td>
<td>2.9868e-11</td>
</tr>
<tr>
<td>Mf (t=364, X=72257)</td>
<td>2.5577e+00</td>
<td>2.5577e+00</td>
<td>5.8565e-13</td>
</tr>
<tr>
<td>Mp (t=248, X=12340)</td>
<td>3.0945e-01</td>
<td>3.0945e-01</td>
<td>6.2886e-12</td>
</tr>
<tr>
<td>Md (t=330, X=2822)</td>
<td>6.4599e-01</td>
<td>6.4599e-01</td>
<td>2.4319e-13</td>
</tr>
<tr>
<td>Lp (t=284, X=54698)</td>
<td>9.8967e-205</td>
<td>9.8967e-205</td>
<td>4.0915e-11</td>
</tr>
<tr>
<td>Ld (t=257, X=39946)</td>
<td>4.9865e+00</td>
<td>4.9865e+00</td>
<td>5.5929e-14</td>
</tr>
<tr>
<td>benthic_prey (t=134, X=77347)</td>
<td>5.0557e-01</td>
<td>5.0557e-01</td>
<td>2.1016e-13</td>
</tr>
</tbody>
</table>



<a name="53377"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/53377" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colleen Petrik <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#53377">(Apr 08 2022 at 00:17)</a>:</h4>
<p><span class="user-mention" data-user-id="14">@Matt Long</span> and <span class="user-mention" data-user-id="10">@Michael Levy</span> , did the path to the DPLE change? When I try accessing it I am told that the directory does not exist.</p>



<a name="53379"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/33-fisheries/topic/DPLE/near/53379" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="http://127.0.0.1:4000/html/stream/33-fisheries/topic/DPLE.html#53379">(Apr 08 2022 at 01:52)</a>:</h4>
<p>Are you trying to access /glade/campaign from the Cheyenne login node? That’s not possible; campaign is only accessible via Casper.</p>



<hr><p>Last updated: Dec 17 2024 at 18:57 UTC</p>
</html>