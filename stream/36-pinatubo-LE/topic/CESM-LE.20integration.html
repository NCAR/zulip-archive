<html>
<head><meta charset="utf-8"><title>CESM-LE integration · pinatubo-LE · Zulip Chat Archive</title></head>
<h2>Stream: <a href="../../..//stream/36-pinatubo-LE/index.html">pinatubo-LE</a></h2>
<h3>Topic: <a href="../../..//stream/36-pinatubo-LE/topic/CESM-LE.20integration.html">CESM-LE integration</a></h3>

<hr>


<head><link href="../../../style.css" rel="stylesheet"></head>

<a name="21395"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/36-pinatubo-LE/topic/CESM-LE%20integration/near/21395" class="zl"><img src="../../../assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="../../..//stream/36-pinatubo-LE/topic/CESM-LE.20integration.html#21395">(Nov 12 2020 at 21:02)</a>:</h4>
<p>@all, we're planning to repeat a portion of the CESM-LE with different forcing (no Pinatubo). Who has run the LENS tag on Cheyenne? How much do we need to worry about validation?</p>



<a name="21408"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/36-pinatubo-LE/topic/CESM-LE%20integration/near/21408" class="zl"><img src="../../../assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Allison Baker <a href="../../..//stream/36-pinatubo-LE/topic/CESM-LE.20integration.html#21408">(Nov 12 2020 at 22:35)</a>:</h4>
<p>I've only run that tag on Yellowstone (same with <span class="user-mention" data-user-id="37">@Sheri Mickelson</span> I think).   </p>
<p>If you are concerned about differences between CESM-LE on Cheyenne vs. Yellowstone, then I would not be concerned (but I would disable AVX2 (FMA) for the Cheyenne compiler) - I did a fair bit of testing with our CESM-ECT tool  at the time Cheyenne was new and all was good...</p>



<a name="21411"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/36-pinatubo-LE/topic/CESM-LE%20integration/near/21411" class="zl"><img src="../../../assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="../../..//stream/36-pinatubo-LE/topic/CESM-LE.20integration.html#21411">(Nov 12 2020 at 23:16)</a>:</h4>
<p>@nan, have you run the LENS tag on Cheyenne?</p>



<a name="21416"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/36-pinatubo-LE/topic/CESM-LE%20integration/near/21416" class="zl"><img src="../../../assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Lindsay <a href="../../..//stream/36-pinatubo-LE/topic/CESM-LE.20integration.html#21416">(Nov 12 2020 at 23:37)</a>:</h4>
<p>I think <a href="https://svn-ccsm-models.cgd.ucar.edu/cesm1/exp_tags/cesm1_1_2_LENS_n21/" target="_blank" title="https://svn-ccsm-models.cgd.ucar.edu/cesm1/exp_tags/cesm1_1_2_LENS_n21/">https://svn-ccsm-models.cgd.ucar.edu/cesm1/exp_tags/cesm1_1_2_LENS_n21/</a> has known problems resolved on cheyenne.<br>
I have a copy at <code>/glade/work/klindsay/cesm1_tags/cesm1_1_2_LENS_n21</code>.</p>



<a name="21652"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/36-pinatubo-LE/topic/CESM-LE%20integration/near/21652" class="zl"><img src="../../../assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nan Rosenbloom <a href="../../..//stream/36-pinatubo-LE/topic/CESM-LE.20integration.html#21652">(Nov 17 2020 at 20:46)</a>:</h4>
<p>Hi Matt.  Yes, I've run lots of LENS-tag simulations on cheyenne, using the same tag that Keith Lindsay pointed you to.  I've also coordinated several LEs with this tag; let me know if I can help in any way.</p>



<a name="22587"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/36-pinatubo-LE/topic/CESM-LE%20integration/near/22587" class="zl"><img src="../../../assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Levy <a href="../../..//stream/36-pinatubo-LE/topic/CESM-LE.20integration.html#22587">(Dec 07 2020 at 16:50)</a>:</h4>
<blockquote>
<p>If you are concerned about differences between CESM-LE on Cheyenne vs. Yellowstone, then I would not be concerned (but I would disable AVX2 (FMA) for the Cheyenne compiler) - I did a fair bit of testing with our CESM-ECT tool  at the time Cheyenne was new and all was good...</p>
</blockquote>
<p>Thanks for this tip! How do you disable AVX2? I'm trying to look at the n21 tag to see if it has already been done, but I don't think it has been</p>



<a name="22590"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/36-pinatubo-LE/topic/CESM-LE%20integration/near/22590" class="zl"><img src="../../../assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Levy <a href="../../..//stream/36-pinatubo-LE/topic/CESM-LE.20integration.html#22590">(Dec 07 2020 at 16:56)</a>:</h4>
<p>it looks like maybe I want to add the <code>-no-fma</code> flag, and that it isn't already included? Tagging <span class="user-mention" data-user-id="42">@Allison Baker</span> because I forgot to do that when I quoted her in a reply :)</p>



<a name="22602"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/36-pinatubo-LE/topic/CESM-LE%20integration/near/22602" class="zl"><img src="../../../assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Levy <a href="../../..//stream/36-pinatubo-LE/topic/CESM-LE.20integration.html#22602">(Dec 07 2020 at 18:47)</a>:</h4>
<p>Is it possible that <code>-no-fma</code> is set as a default somewhere for intel 18.0.5? I created two cases and ran them both for one month:</p>
<ol>
<li><code>/glade/work/mlevy/codes/pinatubo-LE/cases/b.e11.B20TRC5CNBDRD.f09_g16.001</code></li>
<li><code>/glade/work/mlevy/codes/pinatubo-LE/cases/b.e11.B20TRC5CNBDRD.f09_g16.002</code></li>
</ol>
<p>I didn't make any changes to the first case, but for the second case I added <code>FFLAGS += -no-fma</code> to <code>Macros</code>; this change shows up in the build logs</p>
<div class="codehilite"><pre><span></span>$ zgrep fma /glade/scratch/mlevy/b.e11.B20TRC5CNBDRD.f09_g16.001/bld/ocn.bldlog.*.gz | wc -l
0
$ zgrep fma /glade/scratch/mlevy/b.e11.B20TRC5CNBDRD.f09_g16.002/bld/ocn.bldlog.*.gz | wc -l
112
</pre></div>


<p>but as far as I can tell, the two runs are bit-for-bit identical.</p>



<a name="22604"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/36-pinatubo-LE/topic/CESM-LE%20integration/near/22604" class="zl"><img src="../../../assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Allison Baker <a href="../../..//stream/36-pinatubo-LE/topic/CESM-LE.20integration.html#22604">(Dec 07 2020 at 19:06)</a>:</h4>
<p>So as long as you don't have the -xCORE-AVX2 flag then you may be OK.  Since -no-fma did not do anything, then you are probably not using avx2.  (If you have -xCORE-AVX2 , then it automatically does fma.  It is possible to have both flags -xCORE-AVX2 -no-fma)</p>



<a name="22608"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/36-pinatubo-LE/topic/CESM-LE%20integration/near/22608" class="zl"><img src="../../../assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Levy <a href="../../..//stream/36-pinatubo-LE/topic/CESM-LE.20integration.html#22608">(Dec 07 2020 at 19:51)</a>:</h4>
<p>Just for those following along at home -- I talked with <span class="user-mention" data-user-id="42">@Allison Baker</span> and she agrees that it looks like the current default does not use fma; we think at one point early in the process of porting to cheyenne CSEG had enabled AVX2, which turned fma on by default, but it was turned off when it caused issues with the verification tool and is not enabled in the n21 LENS tag. So we can still compare to the yellowstone output and I don't need to modify anything in the build system.</p>



<hr><p>Last updated: May 16 2025 at 17:14 UTC</p>
</html>