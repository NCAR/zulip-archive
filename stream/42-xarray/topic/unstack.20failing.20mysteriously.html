<html>
<head><meta charset="utf-8"><title>unstack failing mysteriously · xarray · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://127.0.0.1:4000/html/stream/42-xarray/index.html">xarray</a></h2>
<h3>Topic: <a href="http://127.0.0.1:4000/html/stream/42-xarray/topic/unstack.20failing.20mysteriously.html">unstack failing mysteriously</a></h3>

<hr>

<base href="https://zulip2.cloud.ucar.edu">

<head><link href="http://127.0.0.1:4000/style.css" rel="stylesheet"></head>

<a name="101566"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/42-xarray/topic/unstack%20failing%20mysteriously/near/101566" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Medeiros <a href="http://127.0.0.1:4000/html/stream/42-xarray/topic/unstack.20failing.20mysteriously.html#101566">(Jun 28 2024 at 17:26)</a>:</h4>
<p>I'm trying to take a data set with (time, lat, lon) dimensions and convert it to (year, month, lat, lon). I can <em>usually</em> do that by assigning <code>year</code> and <code>month</code> coordinates to the dataset and then unstacking <code>time</code>. But I ran into an issue doing that with a new data set. Trying to diagnose what was happening led me to this small example which I absolutely do not understand. Here I make a 2-year time series and then get the days per month with xarray's accessor method.  I make two versions of the "days per month" array, which are identical according to the <code>.identical</code> method. However, with one version I can unstack time but with the other one I can't. </p>
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"python </span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cftime</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"numpy: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">, xarray: </span><span class="si">{</span><span class="n">xr</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">, cftime: </span><span class="si">{</span><span class="n">cftime</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
       <span class="n">cftime</span><span class="o">.</span><span class="n">DatetimeGregorian</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)])</span>
<span class="n">dss</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">'time'</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">"time"</span><span class="p">:</span><span class="n">t</span><span class="p">})</span>

<span class="c1"># TWO VERSIONS OF "days":</span>
<span class="n">days0</span> <span class="o">=</span> <span class="n">dss</span><span class="p">[</span><span class="s1">'time'</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">daysinmonth</span>

<span class="n">days</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">dss</span><span class="p">[</span><span class="s1">'time'</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">daysinmonth</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">'time'</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">'time'</span><span class="p">:</span><span class="n">dss</span><span class="p">[</span><span class="s1">'time'</span><span class="p">]},</span> <span class="n">attrs</span><span class="o">=</span><span class="n">days0</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'days_in_month'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"IDENTICAL: </span><span class="si">{</span><span class="n">days</span><span class="o">.</span><span class="n">identical</span><span class="p">(</span><span class="n">days0</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">year</span> <span class="o">=</span> <span class="n">dss</span><span class="p">[</span><span class="s1">'time'</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">data</span>
<span class="n">month</span> <span class="o">=</span> <span class="n">dss</span><span class="p">[</span><span class="s1">'time'</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># REPEAT SAME STEPS FOR days and days0:</span>
<span class="n">days</span> <span class="o">=</span> <span class="n">days</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="p">(</span><span class="s2">"time"</span><span class="p">,</span> <span class="n">year</span><span class="p">),</span> <span class="n">month</span><span class="o">=</span><span class="p">(</span><span class="s2">"time"</span><span class="p">,</span> <span class="n">month</span><span class="p">))</span>
<span class="n">days</span> <span class="o">=</span> <span class="n">days</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="p">[</span><span class="s1">'year'</span><span class="p">,</span> <span class="s1">'month'</span><span class="p">])</span>

<span class="n">days0</span> <span class="o">=</span> <span class="n">days0</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="p">(</span><span class="s2">"time"</span><span class="p">,</span> <span class="n">year</span><span class="p">),</span> <span class="n">month</span><span class="o">=</span><span class="p">(</span><span class="s2">"time"</span><span class="p">,</span> <span class="n">month</span><span class="p">))</span>
<span class="n">days0</span> <span class="o">=</span> <span class="n">days0</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="p">[</span><span class="s1">'year'</span><span class="p">,</span> <span class="s1">'month'</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"IDENTICAL: </span><span class="si">{</span><span class="n">days</span><span class="o">.</span><span class="n">identical</span><span class="p">(</span><span class="n">days0</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">days</span> <span class="o">=</span> <span class="n">days</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">'time'</span><span class="p">)</span> <span class="c1"># THIS WORKS</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">days</span><span class="o">.</span><span class="n">dims</span><span class="w"> </span><span class="si">= }</span><span class="s2">"</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">days0</span> <span class="o">=</span> <span class="n">days0</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">'time'</span><span class="p">)</span> <span class="c1"># THIS FAILS</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">days0</span><span class="o">.</span><span class="n">dims</span><span class="w"> </span><span class="si">= }</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<p>My output:</p>
<div class="codehilite"><pre><span></span><code>python 3.12.0 | packaged by conda-forge | (main, Oct  3 2023, 08:36:57) [Clang 15.0.7 ]
numpy: 1.26.4, xarray: 2024.5.0, cftime: 1.6.3
IDENTICAL: True
IDENTICAL: True
days.dims = (&#39;year&#39;, &#39;month&#39;)
...
ValueError: IndexVariable objects must be 1-dimensional
</code></pre></div>
<p>Does anyone have any idea what could be going on here?</p>



<a name="101589"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/42-xarray/topic/unstack%20failing%20mysteriously/near/101589" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Katelyn FitzGerald <a href="http://127.0.0.1:4000/html/stream/42-xarray/topic/unstack.20failing.20mysteriously.html#101589">(Jun 28 2024 at 21:28)</a>:</h4>
<p>Interesting.  I'm having trouble tracking this down.  I noticed it worked in an older env I had and it seems to stop working with v2023.5.0.</p>



<a name="101591"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/42-xarray/topic/unstack%20failing%20mysteriously/near/101591" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Katelyn FitzGerald <a href="http://127.0.0.1:4000/html/stream/42-xarray/topic/unstack.20failing.20mysteriously.html#101591">(Jun 28 2024 at 21:49)</a>:</h4>
<p>There was some work on the dt accessor released in that version.</p>
<p>I'd consider reporting it as a bug if you haven't already.</p>



<a name="101592"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/42-xarray/topic/unstack%20failing%20mysteriously/near/101592" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Medeiros <a href="http://127.0.0.1:4000/html/stream/42-xarray/topic/unstack.20failing.20mysteriously.html#101592">(Jun 28 2024 at 21:51)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="339">@Katelyn FitzGerald</span> . I haven't reported it yet because I wasn't sure how to even describe it. I guess I'll just provide this example and see where it goes.</p>



<a name="101593"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/42-xarray/topic/unstack%20failing%20mysteriously/near/101593" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Katelyn FitzGerald <a href="http://127.0.0.1:4000/html/stream/42-xarray/topic/unstack.20failing.20mysteriously.html#101593">(Jun 28 2024 at 21:56)</a>:</h4>
<p>I think with the additional info about the version where it worked, your nice example here, and the trace/log, someone will be able to piece together what's going on <span aria-label="fingers crossed" class="emoji emoji-1f91e" role="img" title="fingers crossed">:fingers_crossed:</span> .</p>



<a name="101661"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/42-xarray/topic/unstack%20failing%20mysteriously/near/101661" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Medeiros <a href="http://127.0.0.1:4000/html/stream/42-xarray/topic/unstack.20failing.20mysteriously.html#101661">(Jul 01 2024 at 18:34)</a>:</h4>
<p><span class="user-mention" data-user-id="339">@Katelyn FitzGerald</span> -- I did post this to Xarray's issues: <a href="https://github.com/pydata/xarray/issues/9190">https://github.com/pydata/xarray/issues/9190</a></p>
<p>It looks like the issue comes down to the difference between IndexVariable and Variable.</p>



<a name="101706"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/42-xarray/topic/unstack%20failing%20mysteriously/near/101706" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Katelyn FitzGerald <a href="http://127.0.0.1:4000/html/stream/42-xarray/topic/unstack.20failing.20mysteriously.html#101706">(Jul 02 2024 at 16:27)</a>:</h4>
<p>So it looks like <code>dss.reset_index("time").dt.daysinmonth</code> addresses the issue with days0 by changing it from an IndexVariable to Variable and the the dt accessor respects that  and returns a Variable as well so it doesn't fail later on.  </p>
<p>It is interesting that this worked until relatively recently (I checked that it's still an IndexVariable in earlier versions).</p>



<a name="101707"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/42-xarray/topic/unstack%20failing%20mysteriously/near/101707" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Katelyn FitzGerald <a href="http://127.0.0.1:4000/html/stream/42-xarray/topic/unstack.20failing.20mysteriously.html#101707">(Jul 02 2024 at 16:30)</a>:</h4>
<p>Ah, it works in older versions because dt.daysinmonth was previously changing it back to a Variable from the IndexVariable.</p>
<p>Sorry I didn't catch this sooner.</p>



<a name="101708"></a>
<h4><a href="https://zulip2.cloud.ucar.edu#narrow/stream/42-xarray/topic/unstack%20failing%20mysteriously/near/101708" class="zl"><img src="http://127.0.0.1:4000/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Medeiros <a href="http://127.0.0.1:4000/html/stream/42-xarray/topic/unstack.20failing.20mysteriously.html#101708">(Jul 02 2024 at 16:48)</a>:</h4>
<p>Yeah. To me that was mysterious because I didn't even realize there was a <code>variable</code> attribute or a distinction between Variable and IndexVariable. I was hoping that the <code>identical</code> method would have told me about that, but I guess it doesn't check that.</p>



<hr><p>Last updated: Dec 17 2024 at 18:57 UTC</p>
</html>