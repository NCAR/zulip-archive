<html>
<head><meta charset="utf-8"><title>datetime index · python-questions · Zulip Chat Archive</title></head>
<div class='page-content'><h2>Stream: <a href="https://ncar.github.io/zulip-archive/stream/10-python-questions/index.html">python-questions</a></h2>
<h3>Topic: <a href="https://ncar.github.io/zulip-archive/stream/10-python-questions/topic/datetime.20index.html">datetime index</a></h3>

<hr>

<base href="https://zulip2.cloud.ucar.edu/">

<head><link href="https://ncar.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="44187"></a>
<h4><a href="https://zulip2.cloud.ucar.edu/#narrow/stream/10-python-questions/topic/datetime%20index/near/44187" class="zl"><img src="https://ncar.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Long <a href="https://ncar.github.io/zulip-archive/stream/10-python-questions/topic/datetime.20index.html#44187">(Oct 01 2021 at 20:11)</a>:</h4>
<p>Is anyone aware of an issue arising recently with <code>xarray</code> datetime indexing? </p>
<p>I am having trouble indexing a time coordinate with <code>calendar='noleap'</code>.</p>
<p>I can generate a DataArray with <code>calendar='noleap'</code> as follows:</p>
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="n">time</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">2015</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">cftime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="s2">"noleap"</span><span class="p">)</span>
        <span class="p">)</span>
<span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)),</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">"time"</span><span class="p">),</span>
                  <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">"time"</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">"time"</span><span class="p">))})</span>
</code></pre></div>
<p>This indexing operation:</p>
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="n">da</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s2">"2005"</span><span class="p">,</span> <span class="s2">"2006"</span><span class="p">))</span>
</code></pre></div>
<p>Used to work! But with a recent <code>xarray</code> update I get the following error:</p>
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="ne">TypeError</span><span class="p">:</span> <span class="n">cannot</span> <span class="n">compare</span> <span class="n">cftime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="s1">'noleap'</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="ow">and</span>
<span class="n">cftime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="s1">'gregorian'</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<p>But the following <em>does</em> work</p>
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="n">time_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span>
    <span class="n">cftime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="s2">"noleap"</span><span class="p">),</span> <span class="n">cftime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="s2">"noleap"</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">da</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time_slice</span><span class="p">)</span>
</code></pre></div>



<hr><p>Last updated: Oct 02 2021 at 10:06 UTC</p>
</html></div>