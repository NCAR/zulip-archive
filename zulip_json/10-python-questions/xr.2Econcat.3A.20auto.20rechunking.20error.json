[
    {
        "content": "<p>I am attempting to concatenate datasets along an existing dimension and getting the following error.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"ne\">NotImplementedError</span><span class=\"p\">:</span> <span class=\"n\">Can</span> <span class=\"ow\">not</span> <span class=\"n\">use</span> <span class=\"n\">auto</span> <span class=\"n\">rechunking</span> <span class=\"k\">with</span> <span class=\"nb\">object</span> <span class=\"n\">dtype</span><span class=\"o\">.</span> <span class=\"n\">We</span> <span class=\"n\">are</span> <span class=\"n\">unable</span> <span class=\"n\">to</span> <span class=\"n\">estimate</span> <span class=\"n\">the</span> <span class=\"n\">size</span> <span class=\"ow\">in</span> <span class=\"nb\">bytes</span> <span class=\"n\">of</span> <span class=\"nb\">object</span> <span class=\"n\">data</span>\n</pre></div>\n\n\n<p>It's compaining about time, which has cftime objectsâ€”but all datasets are identically chunked. Is there away to avoid triggering the auto rechunking?</p>",
        "id": 36629,
        "sender_full_name": "Matt Long",
        "timestamp": 1625687972
    },
    {
        "content": "<p>I've tracked this down to the <code>time_bound</code> variable (dropping this resolves the problem). Still not entirely sure why...</p>",
        "id": 36631,
        "sender_full_name": "Matt Long",
        "timestamp": 1625688952
    },
    {
        "content": "<p>Since you are using the <code>auto-rechunking</code>,  I don't think there is any workaround other than dropping the <code>time_bound</code> or eagerly loading the <code>time_bound</code> before initiating the concatenation.  E.g.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">ds</span><span class=\"p\">[</span><span class=\"s1\">&#39;time_bound&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">load</span><span class=\"p\">()</span>\n<span class=\"n\">xr</span><span class=\"o\">.</span><span class=\"n\">concat</span><span class=\"p\">([</span><span class=\"o\">.....</span><span class=\"p\">],</span> <span class=\"n\">dim</span><span class=\"o\">=...</span><span class=\"p\">)</span>\n</pre></div>",
        "id": 36632,
        "sender_full_name": "Anderson Banihirwe",
        "timestamp": 1625689022
    },
    {
        "content": "<p>Where is <code>auto-rechunking</code> coming in? All the datasets are identically chunked.</p>",
        "id": 36633,
        "sender_full_name": "Matt Long",
        "timestamp": 1625689071
    },
    {
        "content": "<p>do I need to switch a dask option to turn off auto-rechunking?</p>",
        "id": 36634,
        "sender_full_name": "Matt Long",
        "timestamp": 1625689092
    },
    {
        "content": "<blockquote>\n<p>Where is auto-rechunking coming in? </p>\n</blockquote>\n<p>I was under the impression that you were specifying <code>chunks='auto'</code> somewhere in your workflow. </p>\n<p>Not sure where the issue is coming from... The full traceback might be useful</p>",
        "id": 36635,
        "sender_full_name": "Anderson Banihirwe",
        "timestamp": 1625689633
    },
    {
        "content": "<p>nope</p>",
        "id": 36636,
        "sender_full_name": "Matt Long",
        "timestamp": 1625689644
    },
    {
        "content": "<p>Here's the trace:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"o\">---------------------------------------------------------------------------</span>\n<span class=\"ne\">NotImplementedError</span>                       <span class=\"n\">Traceback</span> <span class=\"p\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"p\">)</span>\n<span class=\"o\">&lt;</span><span class=\"n\">timed</span> <span class=\"n\">exec</span><span class=\"o\">&gt;</span> <span class=\"ow\">in</span> <span class=\"o\">&lt;</span><span class=\"n\">module</span><span class=\"o\">&gt;</span>\n\n<span class=\"o\">~/</span><span class=\"n\">codes</span><span class=\"o\">/</span><span class=\"n\">ocean</span><span class=\"o\">-</span><span class=\"n\">metabolisms</span><span class=\"o\">/</span><span class=\"n\">notebooks</span><span class=\"o\">/</span><span class=\"n\">data_collections</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">to_dataset_dict</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">variable</span><span class=\"p\">,</span> <span class=\"n\">compute</span><span class=\"p\">,</span> <span class=\"n\">clobber</span><span class=\"p\">,</span> <span class=\"n\">prefer_derived</span><span class=\"p\">,</span> <span class=\"n\">refine_query</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n    <span class=\"mi\">120</span>             <span class=\"n\">dsets</span><span class=\"p\">[</span><span class=\"n\">key</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">xr</span><span class=\"o\">.</span><span class=\"n\">concat</span><span class=\"p\">(</span>\n    <span class=\"mi\">121</span>                 <span class=\"p\">[</span><span class=\"n\">ds</span> <span class=\"k\">for</span> <span class=\"n\">ds</span> <span class=\"ow\">in</span> <span class=\"n\">ds_list</span><span class=\"p\">],</span>\n<span class=\"o\">--&gt;</span> <span class=\"mi\">122</span>                 <span class=\"n\">dim</span><span class=\"o\">=</span><span class=\"s1\">&#39;member_id&#39;</span><span class=\"p\">,</span> <span class=\"n\">join</span><span class=\"o\">=</span><span class=\"s1\">&#39;override&#39;</span><span class=\"p\">,</span> <span class=\"n\">combine_attrs</span><span class=\"o\">=</span><span class=\"s1\">&#39;override&#39;</span><span class=\"p\">,</span>\n    <span class=\"mi\">123</span>             <span class=\"p\">)</span>\n    <span class=\"mi\">124</span>             <span class=\"c1\">#dsets[key][&#39;time_bound&#39;] = ds_list[0].time_bound</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">metabolic</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"o\">.</span><span class=\"mi\">7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">xarray</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">concat</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">concat</span><span class=\"p\">(</span><span class=\"n\">objs</span><span class=\"p\">,</span> <span class=\"n\">dim</span><span class=\"p\">,</span> <span class=\"n\">data_vars</span><span class=\"p\">,</span> <span class=\"n\">coords</span><span class=\"p\">,</span> <span class=\"n\">compat</span><span class=\"p\">,</span> <span class=\"n\">positions</span><span class=\"p\">,</span> <span class=\"n\">fill_value</span><span class=\"p\">,</span> <span class=\"n\">join</span><span class=\"p\">,</span> <span class=\"n\">combine_attrs</span><span class=\"p\">)</span>\n    <span class=\"mi\">237</span>         <span class=\"p\">)</span>\n    <span class=\"mi\">238</span>     <span class=\"k\">return</span> <span class=\"n\">f</span><span class=\"p\">(</span>\n<span class=\"o\">--&gt;</span> <span class=\"mi\">239</span>         <span class=\"n\">objs</span><span class=\"p\">,</span> <span class=\"n\">dim</span><span class=\"p\">,</span> <span class=\"n\">data_vars</span><span class=\"p\">,</span> <span class=\"n\">coords</span><span class=\"p\">,</span> <span class=\"n\">compat</span><span class=\"p\">,</span> <span class=\"n\">positions</span><span class=\"p\">,</span> <span class=\"n\">fill_value</span><span class=\"p\">,</span> <span class=\"n\">join</span><span class=\"p\">,</span> <span class=\"n\">combine_attrs</span>\n    <span class=\"mi\">240</span>     <span class=\"p\">)</span>\n    <span class=\"mi\">241</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">metabolic</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"o\">.</span><span class=\"mi\">7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">xarray</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">concat</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">_dataset_concat</span><span class=\"p\">(</span><span class=\"n\">datasets</span><span class=\"p\">,</span> <span class=\"n\">dim</span><span class=\"p\">,</span> <span class=\"n\">data_vars</span><span class=\"p\">,</span> <span class=\"n\">coords</span><span class=\"p\">,</span> <span class=\"n\">compat</span><span class=\"p\">,</span> <span class=\"n\">positions</span><span class=\"p\">,</span> <span class=\"n\">fill_value</span><span class=\"p\">,</span> <span class=\"n\">join</span><span class=\"p\">,</span> <span class=\"n\">combine_attrs</span><span class=\"p\">)</span>\n    <span class=\"mi\">506</span>             <span class=\"k\">except</span> <span class=\"ne\">KeyError</span><span class=\"p\">:</span>\n    <span class=\"mi\">507</span>                 <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{k!r}</span><span class=\"s2\"> is not present in all datasets.&quot;</span><span class=\"p\">)</span>\n<span class=\"o\">--&gt;</span> <span class=\"mi\">508</span>             <span class=\"n\">combined</span> <span class=\"o\">=</span> <span class=\"n\">concat_vars</span><span class=\"p\">(</span><span class=\"nb\">vars</span><span class=\"p\">,</span> <span class=\"n\">dim</span><span class=\"p\">,</span> <span class=\"n\">positions</span><span class=\"p\">,</span> <span class=\"n\">combine_attrs</span><span class=\"o\">=</span><span class=\"n\">combine_attrs</span><span class=\"p\">)</span>\n    <span class=\"mi\">509</span>             <span class=\"k\">assert</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">combined</span><span class=\"p\">,</span> <span class=\"n\">Variable</span><span class=\"p\">)</span>\n    <span class=\"mi\">510</span>             <span class=\"n\">result_vars</span><span class=\"p\">[</span><span class=\"n\">k</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">combined</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">metabolic</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"o\">.</span><span class=\"mi\">7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">xarray</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">variable</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">concat</span><span class=\"p\">(</span><span class=\"n\">variables</span><span class=\"p\">,</span> <span class=\"n\">dim</span><span class=\"p\">,</span> <span class=\"n\">positions</span><span class=\"p\">,</span> <span class=\"n\">shortcut</span><span class=\"p\">,</span> <span class=\"n\">combine_attrs</span><span class=\"p\">)</span>\n   <span class=\"mi\">2860</span>         <span class=\"k\">return</span> <span class=\"n\">IndexVariable</span><span class=\"o\">.</span><span class=\"n\">concat</span><span class=\"p\">(</span><span class=\"n\">variables</span><span class=\"p\">,</span> <span class=\"n\">dim</span><span class=\"p\">,</span> <span class=\"n\">positions</span><span class=\"p\">,</span> <span class=\"n\">shortcut</span><span class=\"p\">,</span> <span class=\"n\">combine_attrs</span><span class=\"p\">)</span>\n   <span class=\"mi\">2861</span>     <span class=\"k\">else</span><span class=\"p\">:</span>\n<span class=\"o\">-&gt;</span> <span class=\"mi\">2862</span>         <span class=\"k\">return</span> <span class=\"n\">Variable</span><span class=\"o\">.</span><span class=\"n\">concat</span><span class=\"p\">(</span><span class=\"n\">variables</span><span class=\"p\">,</span> <span class=\"n\">dim</span><span class=\"p\">,</span> <span class=\"n\">positions</span><span class=\"p\">,</span> <span class=\"n\">shortcut</span><span class=\"p\">,</span> <span class=\"n\">combine_attrs</span><span class=\"p\">)</span>\n   <span class=\"mi\">2863</span>\n   <span class=\"mi\">2864</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">metabolic</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"o\">.</span><span class=\"mi\">7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">xarray</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">variable</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">concat</span><span class=\"p\">(</span><span class=\"bp\">cls</span><span class=\"p\">,</span> <span class=\"n\">variables</span><span class=\"p\">,</span> <span class=\"n\">dim</span><span class=\"p\">,</span> <span class=\"n\">positions</span><span class=\"p\">,</span> <span class=\"n\">shortcut</span><span class=\"p\">,</span> <span class=\"n\">combine_attrs</span><span class=\"p\">)</span>\n   <span class=\"mi\">1819</span>             <span class=\"n\">axis</span> <span class=\"o\">=</span> <span class=\"n\">first_var</span><span class=\"o\">.</span><span class=\"n\">get_axis_num</span><span class=\"p\">(</span><span class=\"n\">dim</span><span class=\"p\">)</span>\n   <span class=\"mi\">1820</span>             <span class=\"n\">dims</span> <span class=\"o\">=</span> <span class=\"n\">first_var</span><span class=\"o\">.</span><span class=\"n\">dims</span>\n<span class=\"o\">-&gt;</span> <span class=\"mi\">1821</span>             <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">duck_array_ops</span><span class=\"o\">.</span><span class=\"n\">concatenate</span><span class=\"p\">(</span><span class=\"n\">arrays</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"n\">axis</span><span class=\"p\">)</span>\n   <span class=\"mi\">1822</span>             <span class=\"k\">if</span> <span class=\"n\">positions</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n   <span class=\"mi\">1823</span>                 <span class=\"c1\"># TODO: deprecate this option -- we don&#39;t need it for groupby</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">metabolic</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"o\">.</span><span class=\"mi\">7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">xarray</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">duck_array_ops</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">concatenate</span><span class=\"p\">(</span><span class=\"n\">arrays</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"p\">)</span>\n    <span class=\"mi\">310</span> <span class=\"k\">def</span> <span class=\"nf\">concatenate</span><span class=\"p\">(</span><span class=\"n\">arrays</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">):</span>\n    <span class=\"mi\">311</span>     <span class=\"s2\">&quot;&quot;&quot;concatenate() with better dtype promotion rules.&quot;&quot;&quot;</span>\n<span class=\"o\">--&gt;</span> <span class=\"mi\">312</span>     <span class=\"k\">return</span> <span class=\"n\">_concatenate</span><span class=\"p\">(</span><span class=\"n\">as_shared_dtype</span><span class=\"p\">(</span><span class=\"n\">arrays</span><span class=\"p\">),</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"n\">axis</span><span class=\"p\">)</span>\n    <span class=\"mi\">313</span>\n    <span class=\"mi\">314</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">metabolic</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"o\">.</span><span class=\"mi\">7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">xarray</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">duck_array_ops</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">f</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n     <span class=\"mi\">54</span>             <span class=\"k\">else</span><span class=\"p\">:</span>\n     <span class=\"mi\">55</span>                 <span class=\"n\">wrapped</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"n\">eager_module</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n<span class=\"o\">---&gt;</span> <span class=\"mi\">56</span>             <span class=\"k\">return</span> <span class=\"n\">wrapped</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n     <span class=\"mi\">57</span>\n     <span class=\"mi\">58</span>     <span class=\"k\">else</span><span class=\"p\">:</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">metabolic</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"o\">.</span><span class=\"mi\">7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">dask</span><span class=\"o\">/</span><span class=\"n\">array</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">concatenate</span><span class=\"p\">(</span><span class=\"n\">seq</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"p\">,</span> <span class=\"n\">allow_unknown_chunksizes</span><span class=\"p\">)</span>\n   <span class=\"mi\">3454</span>     <span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">wrap</span>\n   <span class=\"mi\">3455</span>\n<span class=\"o\">-&gt;</span> <span class=\"mi\">3456</span>     <span class=\"n\">seq</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">asarray</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">a</span> <span class=\"ow\">in</span> <span class=\"n\">seq</span><span class=\"p\">]</span>\n   <span class=\"mi\">3457</span>\n   <span class=\"mi\">3458</span>     <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">seq</span><span class=\"p\">:</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">metabolic</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"o\">.</span><span class=\"mi\">7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">dask</span><span class=\"o\">/</span><span class=\"n\">array</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"o\">&lt;</span><span class=\"n\">listcomp</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"o\">.</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n   <span class=\"mi\">3454</span>     <span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">wrap</span>\n   <span class=\"mi\">3455</span>\n<span class=\"o\">-&gt;</span> <span class=\"mi\">3456</span>     <span class=\"n\">seq</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">asarray</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">a</span> <span class=\"ow\">in</span> <span class=\"n\">seq</span><span class=\"p\">]</span>\n   <span class=\"mi\">3457</span>\n   <span class=\"mi\">3458</span>     <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">seq</span><span class=\"p\">:</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">metabolic</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"o\">.</span><span class=\"mi\">7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">dask</span><span class=\"o\">/</span><span class=\"n\">array</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">asarray</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n   <span class=\"mi\">3726</span>     <span class=\"k\">elif</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"s2\">&quot;shape&quot;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">),</span> <span class=\"n\">Iterable</span><span class=\"p\">):</span>\n   <span class=\"mi\">3727</span>         <span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">asarray</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">)</span>\n<span class=\"o\">-&gt;</span> <span class=\"mi\">3728</span>     <span class=\"k\">return</span> <span class=\"n\">from_array</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">getitem</span><span class=\"o\">=</span><span class=\"n\">getter_inline</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n   <span class=\"mi\">3729</span>\n   <span class=\"mi\">3730</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">metabolic</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"o\">.</span><span class=\"mi\">7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">dask</span><span class=\"o\">/</span><span class=\"n\">array</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">from_array</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">chunks</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">lock</span><span class=\"p\">,</span> <span class=\"n\">asarray</span><span class=\"p\">,</span> <span class=\"n\">fancy</span><span class=\"p\">,</span> <span class=\"n\">getitem</span><span class=\"p\">,</span> <span class=\"n\">meta</span><span class=\"p\">)</span>\n   <span class=\"mi\">2761</span>\n   <span class=\"mi\">2762</span>     <span class=\"n\">chunks</span> <span class=\"o\">=</span> <span class=\"n\">normalize_chunks</span><span class=\"p\">(</span>\n<span class=\"o\">-&gt;</span> <span class=\"mi\">2763</span>         <span class=\"n\">chunks</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">,</span> <span class=\"n\">dtype</span><span class=\"o\">=</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">dtype</span><span class=\"p\">,</span> <span class=\"n\">previous_chunks</span><span class=\"o\">=</span><span class=\"n\">previous_chunks</span>\n   <span class=\"mi\">2764</span>     <span class=\"p\">)</span>\n   <span class=\"mi\">2765</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">metabolic</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"o\">.</span><span class=\"mi\">7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">dask</span><span class=\"o\">/</span><span class=\"n\">array</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">normalize_chunks</span><span class=\"p\">(</span><span class=\"n\">chunks</span><span class=\"p\">,</span> <span class=\"n\">shape</span><span class=\"p\">,</span> <span class=\"n\">limit</span><span class=\"p\">,</span> <span class=\"n\">dtype</span><span class=\"p\">,</span> <span class=\"n\">previous_chunks</span><span class=\"p\">)</span>\n   <span class=\"mi\">2467</span>\n   <span class=\"mi\">2468</span>     <span class=\"k\">if</span> <span class=\"nb\">any</span><span class=\"p\">(</span><span class=\"n\">c</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;auto&quot;</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">chunks</span><span class=\"p\">):</span>\n<span class=\"o\">-&gt;</span> <span class=\"mi\">2469</span>         <span class=\"n\">chunks</span> <span class=\"o\">=</span> <span class=\"n\">auto_chunks</span><span class=\"p\">(</span><span class=\"n\">chunks</span><span class=\"p\">,</span> <span class=\"n\">shape</span><span class=\"p\">,</span> <span class=\"n\">limit</span><span class=\"p\">,</span> <span class=\"n\">dtype</span><span class=\"p\">,</span> <span class=\"n\">previous_chunks</span><span class=\"p\">)</span>\n   <span class=\"mi\">2470</span>\n   <span class=\"mi\">2471</span>     <span class=\"k\">if</span> <span class=\"n\">shape</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">metabolic</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"o\">.</span><span class=\"mi\">7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">dask</span><span class=\"o\">/</span><span class=\"n\">array</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">auto_chunks</span><span class=\"p\">(</span><span class=\"n\">chunks</span><span class=\"p\">,</span> <span class=\"n\">shape</span><span class=\"p\">,</span> <span class=\"n\">limit</span><span class=\"p\">,</span> <span class=\"n\">dtype</span><span class=\"p\">,</span> <span class=\"n\">previous_chunks</span><span class=\"p\">)</span>\n   <span class=\"mi\">2551</span>     <span class=\"k\">if</span> <span class=\"n\">dtype</span><span class=\"o\">.</span><span class=\"n\">hasobject</span><span class=\"p\">:</span>\n   <span class=\"mi\">2552</span>         <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span><span class=\"p\">(</span>\n<span class=\"o\">-&gt;</span> <span class=\"mi\">2553</span>             <span class=\"s2\">&quot;Can not use auto rechunking with object dtype. &quot;</span>\n   <span class=\"mi\">2554</span>             <span class=\"s2\">&quot;We are unable to estimate the size in bytes of object data&quot;</span>\n   <span class=\"mi\">2555</span>         <span class=\"p\">)</span>\n\n<span class=\"ne\">NotImplementedError</span><span class=\"p\">:</span> <span class=\"n\">Can</span> <span class=\"ow\">not</span> <span class=\"n\">use</span> <span class=\"n\">auto</span> <span class=\"n\">rechunking</span> <span class=\"k\">with</span> <span class=\"nb\">object</span> <span class=\"n\">dtype</span><span class=\"o\">.</span> <span class=\"n\">We</span> <span class=\"n\">are</span> <span class=\"n\">unable</span> <span class=\"n\">to</span> <span class=\"n\">estimate</span> <span class=\"n\">the</span> <span class=\"n\">size</span> <span class=\"ow\">in</span> <span class=\"nb\">bytes</span> <span class=\"n\">of</span> <span class=\"nb\">object</span> <span class=\"n\">data</span>\n</pre></div>",
        "id": 36638,
        "sender_full_name": "Matt Long",
        "timestamp": 1625689738
    }
]