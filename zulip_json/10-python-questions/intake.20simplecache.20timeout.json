[
    {
        "content": "<p>I have an intake catalog:</p>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code>  <span class=\"nt\">fgapo_CarbonScope_apo99_v2020</span><span class=\"p\">:</span>\n    <span class=\"nt\">driver</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">netcdf</span>\n    <span class=\"nt\">description</span><span class=\"p\">:</span> <span class=\"s\">\"Using</span><span class=\"nv\"> </span><span class=\"s\">an</span><span class=\"nv\"> </span><span class=\"s\">atmospheric</span><span class=\"nv\"> </span><span class=\"s\">inversion</span><span class=\"nv\"> </span><span class=\"s\">technique</span><span class=\"nv\"> </span><span class=\"s\">similar</span><span class=\"nv\"> </span><span class=\"s\">to</span><span class=\"nv\"> </span><span class=\"s\">the</span><span class=\"nv\"> </span><span class=\"s\">Jena</span><span class=\"nv\"> </span><span class=\"s\">CO2</span><span class=\"nv\"> </span><span class=\"s\">inversion,</span><span class=\"nv\"> </span><span class=\"s\">sea-air</span><span class=\"nv\"> </span><span class=\"s\">oxygen</span><span class=\"nv\"> </span><span class=\"s\">exchanges</span><span class=\"nv\"> </span><span class=\"s\">have</span><span class=\"nv\"> </span><span class=\"s\">been</span><span class=\"nv\"> </span><span class=\"s\">estimated</span><span class=\"nv\"> </span><span class=\"s\">from</span><span class=\"nv\"> </span><span class=\"s\">atmospheric</span><span class=\"nv\"> </span><span class=\"s\">O2/N2</span><span class=\"nv\"> </span><span class=\"s\">measurements</span><span class=\"nv\"> </span><span class=\"s\">(RÃ¶denbeck</span><span class=\"nv\"> </span><span class=\"s\">et</span><span class=\"nv\"> </span><span class=\"s\">al.,</span><span class=\"nv\"> </span><span class=\"s\">2008).</span><span class=\"nv\"> </span><span class=\"s\">In</span><span class=\"nv\"> </span><span class=\"s\">order</span><span class=\"nv\"> </span><span class=\"s\">to</span><span class=\"nv\"> </span><span class=\"s\">eliminate</span><span class=\"nv\"> </span><span class=\"s\">the</span><span class=\"nv\"> </span><span class=\"s\">influence</span><span class=\"nv\"> </span><span class=\"s\">of</span><span class=\"nv\"> </span><span class=\"s\">land</span><span class=\"nv\"> </span><span class=\"s\">processes</span><span class=\"nv\"> </span><span class=\"s\">on</span><span class=\"nv\"> </span><span class=\"s\">atmospheric</span><span class=\"nv\"> </span><span class=\"s\">oxygen</span><span class=\"nv\"> </span><span class=\"s\">abundance,</span><span class=\"nv\"> </span><span class=\"s\">the</span><span class=\"nv\"> </span><span class=\"s\">tracer</span><span class=\"nv\"> </span><span class=\"s\">Atmospheric</span><span class=\"nv\"> </span><span class=\"s\">Potential</span><span class=\"nv\"> </span><span class=\"s\">Oxygen</span><span class=\"nv\"> </span><span class=\"s\">(APO)</span><span class=\"nv\"> </span><span class=\"s\">has</span><span class=\"nv\"> </span><span class=\"s\">been</span><span class=\"nv\"> </span><span class=\"s\">used</span><span class=\"nv\"> </span><span class=\"s\">(Stephens</span><span class=\"nv\"> </span><span class=\"s\">et</span><span class=\"nv\"> </span><span class=\"s\">al.,</span><span class=\"nv\"> </span><span class=\"s\">1998).\"</span>\n    <span class=\"nt\">args</span><span class=\"p\">:</span>\n      <span class=\"nt\">urlpath</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">simplecache::http://www.bgc-jena.mpg.de/CarboScope/apo/INVERSION/OUTPUT/apo99_v2020.nc</span>\n      <span class=\"nt\">xarray_kwargs</span><span class=\"p\">:</span>\n        <span class=\"nt\">decode_times</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n      <span class=\"nt\">chunks</span><span class=\"p\">:</span> <span class=\"p p-Indicator\">{}</span>\n      <span class=\"nt\">storage_options</span><span class=\"p\">:</span>\n        <span class=\"nt\">simplecache</span><span class=\"p\">:</span>\n          <span class=\"nt\">same_names</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n          <span class=\"nt\">cache_storage</span><span class=\"p\">:</span> <span class=\"s\">\"{{</span><span class=\"nv\"> </span><span class=\"s\">env(INTAKE_LOCAL_CACHE_DIR)</span><span class=\"nv\"> </span><span class=\"s\">}}\"</span>\n</code></pre></div>\n<p>However, when attempting to load the data, I get a timeout error:</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"o\">---------------------------------------------------------------------------</span>\n<span class=\"n\">FSTimeoutError</span>                            <span class=\"n\">Traceback</span> <span class=\"p\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"p\">)</span>\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">scratch</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">tmp</span><span class=\"o\">/</span><span class=\"n\">ipykernel_302817</span><span class=\"o\">/</span><span class=\"mf\">1914989288.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"o\">&lt;</span><span class=\"n\">module</span><span class=\"o\">&gt;</span>\n<span class=\"o\">----&gt;</span> <span class=\"mi\">1</span> <span class=\"n\">ds</span> <span class=\"o\">=</span> <span class=\"n\">cat</span><span class=\"o\">.</span><span class=\"n\">fgapo_CarbonScope_apo99_v2020</span><span class=\"o\">.</span><span class=\"n\">to_dask</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">compute</span><span class=\"p\">()</span>\n      <span class=\"mi\">2</span> <span class=\"n\">ds</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">sno</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"mf\">.7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">intake_xarray</span><span class=\"o\">/</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">to_dask</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span>\n     <span class=\"mi\">67</span>     <span class=\"k\">def</span> <span class=\"nf\">to_dask</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n     <span class=\"mi\">68</span>         <span class=\"s2\">\"\"\"Return xarray object where variables are dask arrays\"\"\"</span>\n<span class=\"o\">---&gt;</span> <span class=\"mi\">69</span>         <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">read_chunked</span><span class=\"p\">()</span>\n     <span class=\"mi\">70</span>\n     <span class=\"mi\">71</span>     <span class=\"k\">def</span> <span class=\"nf\">close</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">sno</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"mf\">.7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">intake_xarray</span><span class=\"o\">/</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">read_chunked</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span>\n     <span class=\"mi\">42</span>     <span class=\"k\">def</span> <span class=\"nf\">read_chunked</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n     <span class=\"mi\">43</span>         <span class=\"s2\">\"\"\"Return xarray object (which will have chunks)\"\"\"</span>\n<span class=\"o\">---&gt;</span> <span class=\"mi\">44</span>         <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_load_metadata</span><span class=\"p\">()</span>\n     <span class=\"mi\">45</span>         <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ds</span>\n     <span class=\"mi\">46</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">sno</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"mf\">.7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">intake</span><span class=\"o\">/</span><span class=\"n\">source</span><span class=\"o\">/</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">_load_metadata</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span>\n    <span class=\"mi\">234</span>         <span class=\"s2\">\"\"\"load metadata only if needed\"\"\"</span>\n    <span class=\"mi\">235</span>         <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_schema</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n<span class=\"o\">--&gt;</span> <span class=\"mi\">236</span>             <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_schema</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_schema</span><span class=\"p\">()</span>\n    <span class=\"mi\">237</span>             <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">dtype</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_schema</span><span class=\"o\">.</span><span class=\"n\">dtype</span>\n    <span class=\"mi\">238</span>             <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">shape</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_schema</span><span class=\"o\">.</span><span class=\"n\">shape</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">sno</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"mf\">.7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">intake_xarray</span><span class=\"o\">/</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">_get_schema</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span>\n     <span class=\"mi\">16</span>\n     <span class=\"mi\">17</span>         <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ds</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n<span class=\"o\">---&gt;</span> <span class=\"mi\">18</span>             <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_open_dataset</span><span class=\"p\">()</span>\n     <span class=\"mi\">19</span>\n     <span class=\"mi\">20</span>             <span class=\"n\">metadata</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">sno</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"mf\">.7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">intake_xarray</span><span class=\"o\">/</span><span class=\"n\">netcdf</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">_open_dataset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span>\n     <span class=\"mi\">85</span>\n     <span class=\"mi\">86</span>         <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_can_be_local</span><span class=\"p\">:</span>\n<span class=\"o\">---&gt;</span> <span class=\"mi\">87</span>             <span class=\"n\">url</span> <span class=\"o\">=</span> <span class=\"n\">fsspec</span><span class=\"o\">.</span><span class=\"n\">open_local</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">urlpath</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">storage_options</span><span class=\"p\">)</span>\n     <span class=\"mi\">88</span>         <span class=\"k\">else</span><span class=\"p\">:</span>\n     <span class=\"mi\">89</span>             <span class=\"c1\"># https://github.com/intake/filesystem_spec/issues/476#issuecomment-732372918</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">sno</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"mf\">.7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">fsspec</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">open_local</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">storage_options</span><span class=\"p\">)</span>\n    <span class=\"mi\">462</span>             <span class=\"s2\">\" has attribute local_file=True\"</span>\n    <span class=\"mi\">463</span>         <span class=\"p\">)</span>\n<span class=\"o\">--&gt;</span> <span class=\"mi\">464</span>     <span class=\"k\">with</span> <span class=\"n\">of</span> <span class=\"k\">as</span> <span class=\"n\">files</span><span class=\"p\">:</span>\n    <span class=\"mi\">465</span>         <span class=\"n\">paths</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"k\">for</span> <span class=\"n\">f</span> <span class=\"ow\">in</span> <span class=\"n\">files</span><span class=\"p\">]</span>\n    <span class=\"mi\">466</span>     <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">has_magic</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">):</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">sno</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"mf\">.7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">fsspec</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"fm\">__enter__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span>\n    <span class=\"mi\">177</span>             <span class=\"k\">if</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"n\">fs</span><span class=\"p\">,</span> <span class=\"s2\">\"open_many\"</span><span class=\"p\">):</span>\n    <span class=\"mi\">178</span>                 <span class=\"c1\"># check for concurrent cache download; or set up for upload</span>\n<span class=\"o\">--&gt;</span> <span class=\"mi\">179</span>                 <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">files</span> <span class=\"o\">=</span> <span class=\"n\">fs</span><span class=\"o\">.</span><span class=\"n\">open_many</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span>\n    <span class=\"mi\">180</span>                 <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">files</span>\n    <span class=\"mi\">181</span>             <span class=\"k\">if</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"n\">fs</span><span class=\"p\">,</span> <span class=\"s2\">\"fs\"</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"n\">fs</span><span class=\"o\">.</span><span class=\"n\">fs</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">sno</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"mf\">.7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">fsspec</span><span class=\"o\">/</span><span class=\"n\">implementations</span><span class=\"o\">/</span><span class=\"n\">cached</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"o\">&lt;</span><span class=\"k\">lambda</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kw</span><span class=\"p\">)</span>\n    <span class=\"mi\">392</span>             <span class=\"c1\"># it calls `_open`, but is actually in superclass</span>\n    <span class=\"mi\">393</span>             <span class=\"k\">return</span> <span class=\"k\">lambda</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kw</span><span class=\"p\">:</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">),</span> <span class=\"n\">item</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"fm\">__get__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)(</span>\n<span class=\"o\">--&gt;</span> <span class=\"mi\">394</span>                 <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kw</span>\n    <span class=\"mi\">395</span>             <span class=\"p\">)</span>\n    <span class=\"mi\">396</span>         <span class=\"k\">if</span> <span class=\"n\">item</span> <span class=\"ow\">in</span> <span class=\"p\">[</span><span class=\"s2\">\"__reduce_ex__\"</span><span class=\"p\">]:</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">sno</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"mf\">.7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">fsspec</span><span class=\"o\">/</span><span class=\"n\">implementations</span><span class=\"o\">/</span><span class=\"n\">cached</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">open_many</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">open_files</span><span class=\"p\">)</span>\n    <span class=\"mi\">500</span>         <span class=\"k\">if</span> <span class=\"n\">downpath</span><span class=\"p\">:</span>\n    <span class=\"mi\">501</span>             <span class=\"c1\"># skip if all files are already cached and up to date</span>\n<span class=\"o\">--&gt;</span> <span class=\"mi\">502</span>             <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">downpath</span><span class=\"p\">,</span> <span class=\"n\">downfn</span><span class=\"p\">)</span>\n    <span class=\"mi\">503</span>\n    <span class=\"mi\">504</span>             <span class=\"c1\"># update metadata - only happens when downloads are successful</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">sno</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"mf\">.7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">fsspec</span><span class=\"o\">/</span><span class=\"n\">asyn</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">wrapper</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n     <span class=\"mi\">86</span>     <span class=\"k\">def</span> <span class=\"nf\">wrapper</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n     <span class=\"mi\">87</span>         <span class=\"bp\">self</span> <span class=\"o\">=</span> <span class=\"n\">obj</span> <span class=\"ow\">or</span> <span class=\"n\">args</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n<span class=\"o\">---&gt;</span> <span class=\"mi\">88</span>         <span class=\"k\">return</span> <span class=\"n\">sync</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">loop</span><span class=\"p\">,</span> <span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n     <span class=\"mi\">89</span>\n     <span class=\"mi\">90</span>     <span class=\"k\">return</span> <span class=\"n\">wrapper</span>\n\n<span class=\"o\">/</span><span class=\"n\">glade</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">mclong</span><span class=\"o\">/</span><span class=\"n\">miniconda3</span><span class=\"o\">/</span><span class=\"n\">envs</span><span class=\"o\">/</span><span class=\"n\">sno</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"mf\">.7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">fsspec</span><span class=\"o\">/</span><span class=\"n\">asyn</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"ow\">in</span> <span class=\"n\">sync</span><span class=\"p\">(</span><span class=\"n\">loop</span><span class=\"p\">,</span> <span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"n\">timeout</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n     <span class=\"mi\">65</span>     <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">],</span> <span class=\"n\">asyncio</span><span class=\"o\">.</span><span class=\"n\">TimeoutError</span><span class=\"p\">):</span>\n     <span class=\"mi\">66</span>         <span class=\"c1\"># suppress asyncio.TimeoutError, raise FSTimeoutError</span>\n<span class=\"o\">---&gt;</span> <span class=\"mi\">67</span>         <span class=\"k\">raise</span> <span class=\"n\">FSTimeoutError</span>\n     <span class=\"mi\">68</span>     <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">],</span> <span class=\"ne\">BaseException</span><span class=\"p\">):</span>\n     <span class=\"mi\">69</span>         <span class=\"k\">raise</span> <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n\n<span class=\"n\">FSTimeoutError</span><span class=\"p\">:</span>\n</code></pre></div>\n<p>I presume this is because there is some default parameter in <code>fsspec</code> setting a timeout for file transfers. Since this file is ~1.5GB, it's not able to transfer the whole thing in time (though I can see it did transfer some of the data). </p>\n<p>Anybody know how to specify a different value for the timeout?</p>",
        "id": 43326,
        "sender_full_name": "Matt Long",
        "timestamp": 1632306311
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"14\">@Matt Long</span>, </p>\n<p>It's possible to override the default timeout. However, I don't know if this is something one is able to encode in the YAML file because it requires creating a <code>ClientTimeout data structure</code> using <code>aiohttp</code> library... </p>\n<p>You can modify the timeout as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">46</span><span class=\"p\">]:</span> <span class=\"kn\">import</span> <span class=\"nn\">aiohttp</span>\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">49</span><span class=\"p\">]:</span> <span class=\"n\">timeout</span> <span class=\"o\">=</span> <span class=\"n\">aiohttp</span><span class=\"o\">.</span><span class=\"n\">ClientTimeout</span><span class=\"p\">(</span><span class=\"n\">total</span><span class=\"o\">=</span><span class=\"mi\">1000</span><span class=\"p\">)</span> <span class=\"c1\"># The maximal number of seconds</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">57</span><span class=\"p\">]:</span> <span class=\"n\">storage_options</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">'http'</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s1\">'client_kwargs'</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s1\">'timeout'</span><span class=\"p\">:</span> <span class=\"n\">timeout</span><span class=\"p\">}},</span> <span class=\"s1\">'simplecache'</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s1\">'same_names'</span><span class=\"p\">:</span> <span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"s1\">'cache_storage'</span><span class=\"p\">:</span>  <span class=\"s2\">\"{{ env(INTAKE_LOCAL_CACHE_DIR) }}\"</span><span class=\"p\">}}</span>\n</code></pre></div>\n<p>Once you have  the <code>storage_options</code> dict,  you can invoke the <code>to_dask()</code> method as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"n\">ds</span> <span class=\"o\">=</span> <span class=\"n\">cat</span><span class=\"o\">.</span><span class=\"n\">fgapo_CarbonScope_apo99_v2020</span><span class=\"p\">(</span><span class=\"n\">storage_options</span><span class=\"o\">=</span><span class=\"n\">storage_options</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">to_dask</span><span class=\"p\">()</span>\n</code></pre></div>",
        "id": 43359,
        "sender_full_name": "Anderson Banihirwe",
        "timestamp": 1632330298
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"13\">@Anderson Banihirwe</span>!</p>\n<p>It seems like you should be able to do something like:</p>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code>      <span class=\"nt\">storage_options</span><span class=\"p\">:</span>\n        <span class=\"nt\">http</span><span class=\"p\">:</span>\n          <span class=\"nt\">client_kwargs</span><span class=\"p\">:</span>\n            <span class=\"nt\">timeout</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">3600</span>\n</code></pre></div>\n<p>but indeed, that doesn't work (<code>AttributeError: 'int' object has no attribute 'total'</code>) like you said it wouldn't.</p>",
        "id": 43361,
        "sender_full_name": "Matt Long",
        "timestamp": 1632334692
    }
]