[
    {
        "content": "<p>I'm trying to take a data set with (time, lat, lon) dimensions and convert it to (year, month, lat, lon). I can <em>usually</em> do that by assigning <code>year</code> and <code>month</code> coordinates to the dataset and then unstacking <code>time</code>. But I ran into an issue doing that with a new data set. Trying to diagnose what was happening led me to this small example which I absolutely do not understand. Here I make a 2-year time series and then get the days per month with xarray's accessor method.  I make two versions of the \"days per month\" array, which are identical according to the <code>.identical</code> method. However, with one version I can unstack time but with the other one I can't. </p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">\"python </span><span class=\"si\">{</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">version</span><span class=\"si\">}</span><span class=\"s2\">\"</span><span class=\"p\">)</span>\n<span class=\"kn\">import</span> <span class=\"nn\">xarray</span> <span class=\"k\">as</span> <span class=\"nn\">xr</span>\n<span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"nn\">np</span>\n<span class=\"kn\">import</span> <span class=\"nn\">cftime</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">\"numpy: </span><span class=\"si\">{</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">__version__</span><span class=\"si\">}</span><span class=\"s2\">, xarray: </span><span class=\"si\">{</span><span class=\"n\">xr</span><span class=\"o\">.</span><span class=\"n\">__version__</span><span class=\"si\">}</span><span class=\"s2\">, cftime: </span><span class=\"si\">{</span><span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">__version__</span><span class=\"si\">}</span><span class=\"s2\">\"</span><span class=\"p\">)</span>\n<span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">([</span><span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1979</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1979</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1979</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1979</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1979</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1979</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1979</span><span class=\"p\">,</span> <span class=\"mi\">7</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1979</span><span class=\"p\">,</span> <span class=\"mi\">8</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1979</span><span class=\"p\">,</span> <span class=\"mi\">9</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1979</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1979</span><span class=\"p\">,</span> <span class=\"mi\">11</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1979</span><span class=\"p\">,</span> <span class=\"mi\">12</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1980</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1980</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1980</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1980</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1980</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1980</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1980</span><span class=\"p\">,</span> <span class=\"mi\">7</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1980</span><span class=\"p\">,</span> <span class=\"mi\">8</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1980</span><span class=\"p\">,</span> <span class=\"mi\">9</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1980</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1980</span><span class=\"p\">,</span> <span class=\"mi\">11</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n       <span class=\"n\">cftime</span><span class=\"o\">.</span><span class=\"n\">DatetimeGregorian</span><span class=\"p\">(</span><span class=\"mi\">1980</span><span class=\"p\">,</span> <span class=\"mi\">12</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">has_year_zero</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)])</span>\n<span class=\"n\">dss</span> <span class=\"o\">=</span> <span class=\"n\">xr</span><span class=\"o\">.</span><span class=\"n\">DataArray</span><span class=\"p\">(</span><span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">dims</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'time'</span><span class=\"p\">],</span> <span class=\"n\">coords</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">\"time\"</span><span class=\"p\">:</span><span class=\"n\">t</span><span class=\"p\">})</span>\n\n<span class=\"c1\"># TWO VERSIONS OF \"days\":</span>\n<span class=\"n\">days0</span> <span class=\"o\">=</span> <span class=\"n\">dss</span><span class=\"p\">[</span><span class=\"s1\">'time'</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">dt</span><span class=\"o\">.</span><span class=\"n\">daysinmonth</span>\n\n<span class=\"n\">days</span> <span class=\"o\">=</span> <span class=\"n\">xr</span><span class=\"o\">.</span><span class=\"n\">DataArray</span><span class=\"p\">(</span><span class=\"n\">dss</span><span class=\"p\">[</span><span class=\"s1\">'time'</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">dt</span><span class=\"o\">.</span><span class=\"n\">daysinmonth</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">dims</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'time'</span><span class=\"p\">],</span> <span class=\"n\">coords</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">'time'</span><span class=\"p\">:</span><span class=\"n\">dss</span><span class=\"p\">[</span><span class=\"s1\">'time'</span><span class=\"p\">]},</span> <span class=\"n\">attrs</span><span class=\"o\">=</span><span class=\"n\">days0</span><span class=\"o\">.</span><span class=\"n\">attrs</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">'days_in_month'</span><span class=\"p\">)</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">\"IDENTICAL: </span><span class=\"si\">{</span><span class=\"n\">days</span><span class=\"o\">.</span><span class=\"n\">identical</span><span class=\"p\">(</span><span class=\"n\">days0</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s2\">\"</span><span class=\"p\">)</span>\n\n<span class=\"n\">year</span> <span class=\"o\">=</span> <span class=\"n\">dss</span><span class=\"p\">[</span><span class=\"s1\">'time'</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">dt</span><span class=\"o\">.</span><span class=\"n\">year</span><span class=\"o\">.</span><span class=\"n\">data</span>\n<span class=\"n\">month</span> <span class=\"o\">=</span> <span class=\"n\">dss</span><span class=\"p\">[</span><span class=\"s1\">'time'</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">dt</span><span class=\"o\">.</span><span class=\"n\">month</span><span class=\"o\">.</span><span class=\"n\">data</span>\n\n<span class=\"c1\"># REPEAT SAME STEPS FOR days and days0:</span>\n<span class=\"n\">days</span> <span class=\"o\">=</span> <span class=\"n\">days</span><span class=\"o\">.</span><span class=\"n\">assign_coords</span><span class=\"p\">(</span><span class=\"n\">year</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"s2\">\"time\"</span><span class=\"p\">,</span> <span class=\"n\">year</span><span class=\"p\">),</span> <span class=\"n\">month</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"s2\">\"time\"</span><span class=\"p\">,</span> <span class=\"n\">month</span><span class=\"p\">))</span>\n<span class=\"n\">days</span> <span class=\"o\">=</span> <span class=\"n\">days</span><span class=\"o\">.</span><span class=\"n\">set_index</span><span class=\"p\">(</span><span class=\"n\">time</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'year'</span><span class=\"p\">,</span> <span class=\"s1\">'month'</span><span class=\"p\">])</span>\n\n<span class=\"n\">days0</span> <span class=\"o\">=</span> <span class=\"n\">days0</span><span class=\"o\">.</span><span class=\"n\">assign_coords</span><span class=\"p\">(</span><span class=\"n\">year</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"s2\">\"time\"</span><span class=\"p\">,</span> <span class=\"n\">year</span><span class=\"p\">),</span> <span class=\"n\">month</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"s2\">\"time\"</span><span class=\"p\">,</span> <span class=\"n\">month</span><span class=\"p\">))</span>\n<span class=\"n\">days0</span> <span class=\"o\">=</span> <span class=\"n\">days0</span><span class=\"o\">.</span><span class=\"n\">set_index</span><span class=\"p\">(</span><span class=\"n\">time</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'year'</span><span class=\"p\">,</span> <span class=\"s1\">'month'</span><span class=\"p\">])</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">\"IDENTICAL: </span><span class=\"si\">{</span><span class=\"n\">days</span><span class=\"o\">.</span><span class=\"n\">identical</span><span class=\"p\">(</span><span class=\"n\">days0</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s2\">\"</span><span class=\"p\">)</span>\n\n<span class=\"n\">days</span> <span class=\"o\">=</span> <span class=\"n\">days</span><span class=\"o\">.</span><span class=\"n\">unstack</span><span class=\"p\">(</span><span class=\"s1\">'time'</span><span class=\"p\">)</span> <span class=\"c1\"># THIS WORKS</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">\"</span><span class=\"si\">{</span><span class=\"n\">days</span><span class=\"o\">.</span><span class=\"n\">dims</span><span class=\"w\"> </span><span class=\"si\">= }</span><span class=\"s2\">\"</span><span class=\"p\">)</span>\n<span class=\"c1\">#</span>\n<span class=\"n\">days0</span> <span class=\"o\">=</span> <span class=\"n\">days0</span><span class=\"o\">.</span><span class=\"n\">unstack</span><span class=\"p\">(</span><span class=\"s1\">'time'</span><span class=\"p\">)</span> <span class=\"c1\"># THIS FAILS</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">\"</span><span class=\"si\">{</span><span class=\"n\">days0</span><span class=\"o\">.</span><span class=\"n\">dims</span><span class=\"w\"> </span><span class=\"si\">= }</span><span class=\"s2\">\"</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>My output:</p>\n<div class=\"codehilite\"><pre><span></span><code>python 3.12.0 | packaged by conda-forge | (main, Oct  3 2023, 08:36:57) [Clang 15.0.7 ]\nnumpy: 1.26.4, xarray: 2024.5.0, cftime: 1.6.3\nIDENTICAL: True\nIDENTICAL: True\ndays.dims = (&#39;year&#39;, &#39;month&#39;)\n...\nValueError: IndexVariable objects must be 1-dimensional\n</code></pre></div>\n<p>Does anyone have any idea what could be going on here?</p>",
        "id": 101566,
        "sender_full_name": "Brian Medeiros",
        "timestamp": 1719595614
    },
    {
        "content": "<p>Interesting.  I'm having trouble tracking this down.  I noticed it worked in an older env I had and it seems to stop working with v2023.5.0.</p>",
        "id": 101589,
        "sender_full_name": "Katelyn FitzGerald",
        "timestamp": 1719610112
    },
    {
        "content": "<p>There was some work on the dt accessor released in that version.</p>\n<p>I'd consider reporting it as a bug if you haven't already.</p>",
        "id": 101591,
        "sender_full_name": "Katelyn FitzGerald",
        "timestamp": 1719611353
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"339\">@Katelyn FitzGerald</span> . I haven't reported it yet because I wasn't sure how to even describe it. I guess I'll just provide this example and see where it goes.</p>",
        "id": 101592,
        "sender_full_name": "Brian Medeiros",
        "timestamp": 1719611502
    },
    {
        "content": "<p>I think with the additional info about the version where it worked, your nice example here, and the trace/log, someone will be able to piece together what's going on <span aria-label=\"fingers crossed\" class=\"emoji emoji-1f91e\" role=\"img\" title=\"fingers crossed\">:fingers_crossed:</span> .</p>",
        "id": 101593,
        "sender_full_name": "Katelyn FitzGerald",
        "timestamp": 1719611786
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"339\">@Katelyn FitzGerald</span> -- I did post this to Xarray's issues: <a href=\"https://github.com/pydata/xarray/issues/9190\">https://github.com/pydata/xarray/issues/9190</a></p>\n<p>It looks like the issue comes down to the difference between IndexVariable and Variable.</p>",
        "id": 101661,
        "sender_full_name": "Brian Medeiros",
        "timestamp": 1719858872
    },
    {
        "content": "<p>So it looks like <code>dss.reset_index(\"time\").dt.daysinmonth</code> addresses the issue with days0 by changing it from an IndexVariable to Variable and the the dt accessor respects that  and returns a Variable as well so it doesn't fail later on.  </p>\n<p>It is interesting that this worked until relatively recently (I checked that it's still an IndexVariable in earlier versions).</p>",
        "id": 101706,
        "sender_full_name": "Katelyn FitzGerald",
        "timestamp": 1719937643
    },
    {
        "content": "<p>Ah, it works in older versions because dt.daysinmonth was previously changing it back to a Variable from the IndexVariable.</p>\n<p>Sorry I didn't catch this sooner.</p>",
        "id": 101707,
        "sender_full_name": "Katelyn FitzGerald",
        "timestamp": 1719937858
    },
    {
        "content": "<p>Yeah. To me that was mysterious because I didn't even realize there was a <code>variable</code> attribute or a distinction between Variable and IndexVariable. I was hoping that the <code>identical</code> method would have told me about that, but I guess it doesn't check that.</p>",
        "id": 101708,
        "sender_full_name": "Brian Medeiros",
        "timestamp": 1719938887
    }
]