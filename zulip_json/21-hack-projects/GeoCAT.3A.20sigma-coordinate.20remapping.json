[
    {
        "content": "<p>Here's a minimum working example of some code that remaps the ocean model from <code>z</code> coordinates to <code>sigma</code> coordinates.   <br/>\n<a href=\"https://github.com/matt-long/remap_z_to_sigma/tree/master\" target=\"_blank\" title=\"https://github.com/matt-long/remap_z_to_sigma/tree/master\">https://github.com/matt-long/remap_z_to_sigma/tree/master</a></p>\n<p>This is based on code that <span class=\"user-mention\" data-user-id=\"31\">@Keith Lindsay</span> wrote in F77 and I wrapped with f2py.</p>\n<p>I wrote the Python wrapper...as a project to learn Python (this origin is abundantly evident in the code).</p>\n<p>While I am using <code>dask.delayed</code>to work on time chunks in parallel, my remapper code is setup to read and write files (i.e. it is doing I/O!). </p>\n<p>[You can see my bias here in the command line interface (CLI) I built. I used to do that a lot. As I've starting using Jupyter to interact with my data, I rarely do that anymore.]</p>\n<p>The code breaks up input datasets (timeseries) into multiple time-chunk files; it operates on each and concatenate output files with <code>nco</code>. </p>\n<p>There are several shortcomings:</p>\n<ul>\n<li>This works, but is not as performant as it could be. This is an embarrassingly parallel problem, each vertical column is independent.</li>\n<li>It's also clunky.  Mixing the computation with I/O makes this tool less useful than it could be if it just operated on an <code>xarray.Dataset</code> or <code>DataArrays</code>. This would offer opportunities to explore <code>dask</code> parallelism (and could in theory still support a CLI for files). </li>\n<li>Finally, this code is POP centric, but should be general.</li>\n</ul>\n<p>I would like to invite contributions to improving the workflow for this operation. This notebook illustrates the workflow<br/>\n<a href=\"https://github.com/matt-long/remap_z_to_sigma/blob/master/sigma_remap.ipynb\" target=\"_blank\" title=\"https://github.com/matt-long/remap_z_to_sigma/blob/master/sigma_remap.ipynb\">https://github.com/matt-long/remap_z_to_sigma/blob/master/sigma_remap.ipynb</a><br/>\nDepends on data on glade but can work on any POP output (<code>PD</code> variable required).</p>\n<p><span class=\"user-mention\" data-user-id=\"18\">@Orhan Eroglu</span> would you be willing to lead this effort?  <span class=\"user-mention\" data-user-id=\"13\">@Anderson Banihirwe</span>, we've discussed this before, so would good to have you involved. <span class=\"user-mention\" data-user-id=\"31\">@Keith Lindsay</span> and <span class=\"user-mention\" data-user-id=\"10\">@Michael Levy</span> may have important insight and advice. </p>\n<p>Some questions:</p>\n<ul>\n<li>Can this functionality be replicated with existing tools in the pangeo stack? (i.e. <code>xhistogram</code>, <code>xgcm</code>)</li>\n<li>If not, where should this functionality be implemented?</li>\n</ul>\n<p>cc <span class=\"user-group-mention\" data-user-group-id=\"1\">@geocat</span>, <span class=\"user-mention\" data-user-id=\"*\">@all</span></p>",
        "id": 3276,
        "sender_full_name": "Matt Long",
        "timestamp": 1584241578
    },
    {
        "content": "<p>This would of course be a very useful tool to have in <code>pop_tools</code> or as a standalone utility. For some inspiration,  Spencer Jones wrote <a href=\"https://github.com/cspencerjones/xlayers\" target=\"_blank\" title=\"https://github.com/cspencerjones/xlayers\">https://github.com/cspencerjones/xlayers</a> at the CMIP6 hackathon. I think it wraps some fortran code as well and interfaces with <code>xarray</code>. It's supposedly finished for the most part, but the docs are not great. I haven't tried it yet. But it might serve as some inspiration for how to handle this for POP. Or perhaps it can be leveraged directly. Just some thoughts.</p>",
        "id": 3278,
        "sender_full_name": "Riley Brady",
        "timestamp": 1584288008
    },
    {
        "content": "<p>Hi Matt,</p>\n<p>I noticed with <span class=\"user-mention\" data-user-id=\"19\">@John Clyne</span> 's reminder that I have missed this message within the last week's email flows. Sorry to you, thanks to John!</p>\n<p>My short answer is yes; I would be glad to make this effort. Thanks a lot for the insights you have already given. I will get into the code in the following days and try to come up with an interpretation of mine.</p>\n<p>Talk to you soon on this!</p>",
        "id": 4480,
        "sender_full_name": "Orhan Eroglu",
        "timestamp": 1584935849
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"14\">@Matt Long</span> , <span class=\"user-mention\" data-user-id=\"13\">@Anderson Banihirwe</span>, <span class=\"user-mention\" data-user-id=\"31\">@Keith Lindsay</span>, <span class=\"user-mention\" data-user-id=\"10\">@Michael Levy</span>, and possible others who would be interested and/or have previous effort with this z-to-sigma remapping work. </p>\n<p>I will be trying to get familiar with this code as well as potentially usable existing resources such as Pangeo stack from now on. Any recommendations or plans from your expertise on how to kick off and further proceed this effort  would be great to hear. I will be reporting my findings as well.</p>",
        "id": 6427,
        "sender_full_name": "Orhan Eroglu",
        "timestamp": 1586549457
    }
]